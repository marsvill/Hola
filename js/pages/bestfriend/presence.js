const PreventDuplicateScript_117=0;const BestFriendPresenceScript=document.currentScript;function FetchFromPresenceHelper(p){return new Promise(async l=>{function t(n){document.removeEventListener("RobloxQoL.GetBestFriendsPresenceResponse",t),l(n?.detail)}for(document.addEventListener("RobloxQoL.GetBestFriendsPresenceResponse",t);!BestFriendPresenceScript.getAttribute("presencehelper-ready");)await new Promise(n=>setTimeout(n,50));document.dispatchEvent(new CustomEvent("RobloxQoL.GetBestFriendsPresence",{detail:p}))})}function IsFeatureEnabled(p){return new Promise(async l=>{function t(n){document.removeEventListener("RobloxQoL.IsFeatureEnabledResponse",t),l(n?.detail)}document.addEventListener("RobloxQoL.IsFeatureEnabledResponse",t),document.dispatchEvent(new CustomEvent("RobloxQoL.IsFeatureEnabled",{detail:p}))})}function SplitArrayIntoChunks(p,l){const t=[];for(let n=0;n<p.length;n+=l){const i=p.slice(n,n+l);t.push(i)}return t}async function PopulateUniverse(p){const l=SplitArrayIntoChunks(p,10);for(;l.length>0;){const t=[],n={},i=l.pop();for(let u=0;u<i.length;u++){const a=i[u];t.push(a.universeId),n[a.universeId]||(n[a.universeId]=[]),n[a.universeId].push(a)}try{const c=(await(await fetch(`https://games.roblox.com/v1/games?universeIds=${t.join(",")}`)).json()).data;for(let e=0;e<c.length;e++){const s=c[e],o=n[s.id];for(let r=0;r<o.length;r++){const d=o[r];d.rootPlaceId=s.rootPlaceId,d.placeId||(d.placeId=s.rootPlaceId),d.lastLocation=s.name}}}catch{}}}IsFeatureEnabled("BestFriendPresenceV3").then(function(p){if(!p||!window.location.href.includes("www.roblox.com"))return;InterceptXMLHttpRequest(function(t){return t==="https://presence.roblox.com/v1/presence/users"},async function(t){if(t.status===200){var n;try{n=JSON.parse(t.responseText)}catch{}if(n){const i=[],u=n.userPresences,a={};for(let c=0;c<u.length;c++){const e=u[c];e.userPresenceType!==2||e.universeId||(a[e.userId]=e,i.push(e.userId))}if(i.length>0){const c=[];if(i.length===1)try{const e=await FetchFromPresenceHelper(i);if(e&&e.ok){const s=e.json;if(s.UniverseId){const o=a[i[0]];o.universeId=s.UniverseId,o.gameId=s.JobId,o.fromRoQoL=!0,c.push(o)}}}catch(e){console.log(e)}else try{const e=await FetchFromPresenceHelper(i);if(e&&e.ok){const s=e.json;for(let o=0;o<s.length;o++){const r=s[o],d=a[r.UserId];d.universeId=r.UniverseId,d.gameId=r.JobId,d.fromRoQoL=!0,c.push(d)}}}catch(e){console.log(e)}c.length>0&&await PopulateUniverse(c);try{Object.defineProperties(t,{responseText:{writable:!0,configurable:!0,value:JSON.stringify(n)},response:{writable:!0,configurable:!0,value:n}})}catch(e){console.warn(e)}}}}});const l=fetch.bind(globalThis);window.fetch=async function(...t){const n=await l(...t);if(n.url!=="https://presence.roblox.com/v1/presence/users"||!n.ok)return n;const i=await n.clone().json(),u=[],a=i.userPresences,c={};for(let e=0;e<a.length;e++){const s=a[e];s.userPresenceType!==2||s.universeId||(c[s.userId]=s,u.push(s.userId))}if(u.length>0){const e=[];if(u.length===1)try{const s=await FetchFromPresenceHelper(u);if(s&&s.ok){const o=s.json;if(o.UniverseId){const r=c[u[0]];r.universeId=o.UniverseId,r.gameId=o.JobId,r.fromRoQoL=!0,e.push(r)}}}catch(s){console.log(s)}else try{const s=await FetchFromPresenceHelper(u);if(s&&s.ok){const o=s.json;for(let r=0;r<o.length;r++){const d=o[r],f=c[d.UserId];f.universeId=d.UniverseId,f.gameId=d.JobId,f.fromRoQoL=!0,e.push(f)}}}catch(s){console.log(s)}return e.length>0&&await PopulateUniverse(e),new Response(JSON.stringify(i),{status:n.status,statusText:n.statusText,headers:n.headers})}return n}});

//# sourceMappingURL=https://roqol.io/assets/sourcemap/chrome/2.33.1/js/pages/bestfriend/presence.js