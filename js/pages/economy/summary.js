const PreventDuplicateScript_132=0;const ListenToTimeChange=[];function GetTableRow(r,a){const i=r.children;for(let o=0;o<i.length;o++){const c=i[o];if(c.children[0]?.innerText==a)return c}}async function WaitForTableRow(r,a){for(;;){const i=GetTableRow(r,a);if(i)return i;await sleep(100)}}function CreateGroupItem(r,a){const i=`https://www.roblox.com/${r.Type=="Group"&&"group"||r.Type=="Place"&&"games"||r.Type=="GamePass"&&"game-pass"||r.Type=="User"&&"users"||r.Type=="Asset"&&"catalog"}/${r.Type=="Place"&&r.Place.placeId||r.Id}/${r.Type=="User"&&"profile"||"-"}`,o=document.createElement("div");o.style=a+"padding: 9px; height: 62px; display: flex; align-items: center;";const c=document.createElement("div");c.className="avatar avatar-headshot-xs group-icon",c.style="float: left; flex-shrink: 0; margin-right: 12px;";const m=document.createElement(r.Type!="DeveloperProduct"&&"a"||"span");m.className="avatar-card-link",m.href=i;const A=document.createElement("span");A.className="thumbnail-2d-container";const w=document.createElement("img");w.src=r.Icon||"https://create.roblox.com/assets/thumbnails/broken.svg",A.appendChild(w),m.appendChild(A),c.appendChild(m);const I=document.createElement("div");I.className="avatar-card-caption",I.style="width: calc(100% - 44px);";const h=document.createElement(r.Type!="DeveloperProduct"&&"a"||"span");h.className=`avatar-card-name ${r.Type!="DeveloperProduct"&&"text-name"||""} text-overflow`,h.href=i,h.innerText=r.Name,I.appendChild(h);const d=document.createElement("td");d.style="display: flex;";const l=document.createElement("span");l.className="icon-robux-16x16";const T=document.createElement("span");return T.innerText=numberWithCommas(r.Robux),d.append(l,T),o.append(c,I,d),o}async function GetTypeAndIdFromURL(){if(!window.location.href.includes("/groups/configure"))return["users",await GetUserId()];const r=new URLSearchParams(window.location.search);return["groups",parseInt(r.get("id"))]}async function CreateDetailedSummary(r,a,i,o,c,m,A){const w=r.children[0],I=r.children[1],h=I.children[2],d=document.createElement("a"),l=document.createElement("span");l.className="icon-right-16x16",l.style="margin-left: 10px;",d.innerText=w.innerText,w.innerText="",d.appendChild(l);const T=document.createElement("div");let U,B,G;m&&([U,B,G]=CreateCSVUpload(),U.style.display="none");const u=document.createElement("span");I.insertBefore(u,h),w.appendChild(d);let v,P,E=!1,N=!1,g;async function D(b){if(!b&&(!i(v)||E))return;for(E=!0,N=!1;T.firstChild;)T.removeChild(T.lastChild);let y;const e=document.createElement("div");if(e.className="spinner spinner-default",T.style.paddingTop="10px",u.style.display="none",h&&(h.style["text-decoration"]="",h.style["margin-left"]=""),T.appendChild(e),b){await a("Cancel"),c[0]++;const t=c[0];if(y=await b,c[0]!=t||(A&&(y=await A(y,v,c,t)),c[0]!=t))return;y&&y.sort(function(n,p){return p.Robux-n.Robux});let s=0;for(let n=0;n<y.length;n++)s+=y[n].Robux;u.innerText=numberWithCommas(s),u.style.display="",h&&(h.style["text-decoration"]="line-through",h.style["margin-left"]="8px"),N=!0,e.remove()}else{P&&(P.style.display="none");const[t,s,n]=await a(v);if(N=!0,y=n,e.remove(),t&&s)return;if(!t){const p=document.createElement("p");p.innerText="Failed to load";return}}if(y){y.length==0?T.style.paddingTop="":T.style.paddingTop="10px",P&&(P.style.display="revert");for(let t=0;t<y.length;t++)T.appendChild(CreateGroupItem(y[t],(t+1)%2==1&&"background-color: #393b3d; "||""))}}let R=!1;if(d.addEventListener("click",function(){R=!R,T.style.display=!R&&"none"||"",I.style.display=R&&"block"||"",P&&(P.style.display=R&&N&&"revert"||"none"),U&&(U.style.display=!R&&"none"||"contents"),l.className=`icon-${R&&"down"||"right"}-16x16`,D()}),ListenToTimeChange.push(function(){E=!1,R&&!g&&D()}),o){v=o[0];const[b,y,e,t]=CreateDropdownList(v);P=b,b.style.display="none",b.style.float="",b.style.top="";const s=b.getElementsByTagName("button")[0];s.style.height="30px",s.getElementsByClassName("icon-down-16x16")[0].style.marginTop="2px",e.style.fontSize="14px",e.style.lineHeight="20px";for(let n=0;n<o.length;n++){const p=o[n],[f,S]=CreateDropdownButton(p);S.addEventListener("click",function(){v=p,e.innerText=p,E=!1,t(),D(g&&m(g,v))}),y.appendChild(f)}w.appendChild(b)}U&&(G.addEventListener("click",async function(b){g&&(g=null,B.value=null,E=!1,G.innerText="Upload CSV Instead",b.stopImmediatePropagation(),await sleep(10),G.setAttribute("for","uploadCSV"),D())}),B.addEventListener("change",function(b){const y=b.target.files[0];if(!y)return;let e=new FileReader;e.onload=async function(t){g=t.target.result,E=!1,G.removeAttribute("for"),G.innerText="Remove CSV",D(m(g,v))},e.readAsText(y)}),w.appendChild(U)),w.appendChild(T)}async function AddIcons(r){const a=SplitArrayIntoChunks(r,100);for(let i=0;i<a.length;i++){const o=a[i],c={},m={},A=[];for(let d=0;d<o.length;d++){const l=o[d];l.Type=="Group"?c[l.Id]=l:m[l.Id]=l,A.push({targetId:l.Id,type:l.Type=="Group"&&"GroupIcon"||l.Type=="Place"&&"GameIcon"||l.Type=="GamePass"&&"GamePass"||l.Type=="DeveloperProduct"&&"DeveloperProduct"||l.Type=="Asset"&&"Asset"||"AvatarHeadShot",requestId:l.Type,size:"150x150"})}const[w,I]=await RequestFunc("https://thumbnails.roblox.com/v1/batch","POST",void 0,JSON.stringify(A),!0);if(!w)continue;const h=I.data;for(let d=0;d<h.length;d++){const l=h[d];(l.requestId=="Group"&&c||m)[l.targetId].Icon=l.imageUrl}}}async function FetchTranscations(r,a,i,o,c){const m=[],A={},w=[];let I="",h=!1;const[d,l]=await GetTypeAndIdFromURL(),T=FetchCache(d,i,o),U=new Date().getTime()/1e3;function B(u){if(u.currency.type!=="Robux"||c&&!c(u))return"continue";if(new Date(u.created).getTime()/1e3<=U-o)return h=!0,"break";const P=u?.details?.place,E=P&&u?.details?.place?.universeId||u.agent.id;if(!A[E]){const N=u?.details?.place,g={Type:P&&"Place"||u.agent.type,Name:P&&N.name||u.agent.name,Id:E,Robux:0,Place:P&&N};m.push(g),A[g.Id]=g}A[E].Robux+=u.currency.amount,w.push(u)}const G=[];for(;;){const[u,v]=await RequestFunc(`https://economy.roblox.com/v2/${d}/${l}/transactions?cursor=${I}&limit=100&transactionType=${i}`,"GET",void 0,void 0,!0);if(!u)return[!1];const P=v.data,E={};for(let N=0;N<P.length;N++){const g=P[N];if(IsIdInCache(d,i,o,g.id)){for(let R=0;R<T.List.length;R++){const b=T.List[R];if(E[b.id])continue;const y=B(b);if(y!="continue"&&y=="break")break}h=!0;break}const D=B(g);if(G.push(g),E[g.id]=!0,D!="continue"&&D=="break")break}if(h||(I=v.nextPageCursor,!I||r!=a[0]))break}if(h){for(let u=0;u<G.length;u++)AddToCache(d,i,o,G[u]);SortCache(d,i,o),TrimCache(d,i,o),SaveCache(d,i,o)}return[!0,m,w]}IsFeatureEnabled("DetailedGroupTranscationSummary").then(async function(r){if(!r)return;let a=86400*30,i=[0],o=[0],c=[0],m=[0];const[A]=await GetTypeAndIdFromURL();async function w(e){let t=0;ChildAdded(e,!0,function(s){const n=s.children[0],p=t==0&&1||t==1&&7||t==2&&30||t==3&&365;t++,n.addEventListener("click",function(){a=86400*p,i[0]++,o[0]++,c[0]++,m[0]++;for(let f=0;f<ListenToTimeChange.length;f++)ListenToTimeChange[f](a)})})}A=="groups"?WaitForClass("tab-content configure-group-details").then(function(e){ChildAdded(e,!0,async function(t){if(t.nodeType!==Node.ELEMENT_NODE||t.tagName.toLowerCase()!=="revenue-summary")return;const s=await WaitForClassPath(t,"input-group-btn group-dropdown dropdown"),n=await WaitForClassPath(s,"dropdown-menu");w(n)})}):WaitForClass("transaction-date-dropdown").then(async function(e){const t=await WaitForClassPath(e,"dropdown-menu");w(t)});let I=0;function h(){return I!==a}async function d(){if(I==a)return[!0,!0];i[0]++;const e=i[0],[t,s]=await FetchTranscations(e,i,"GroupPayout",a,function(n){return n.agent.type==="Group"});return t?e!=i[0]?[!0,!0]:(s.sort(function(n,p){return p.Robux-n.Robux}),await AddIcons(s),e!=i[0]?[!0,!0]:[!0,!1,s]):[!1]}let l=0;function T(){return l!==a}async function U(){if(l==a)return[!0,!0];o[0]++;const e=o[0],[t,s]=await FetchTranscations(e,o,"EngagementPayout",a);return t?e!=o[0]?[!0,!0]:(s.sort(function(n,p){return p.Robux-n.Robux}),await AddIcons(s),e!=o[0]?[!0,!0]:[!0,!1,s]):[!1]}let B=0,G=0,u="",v;function P(e){return B!==a||u!==e}async function E(e){if(e=="Cancel"){u="Cancel",c[0]++;return}if(B==a&&u==e)return[!0,!0];c[0]++,u=e;const t=c[0];let s,n,p;if(!v||G!=a){if([s,n,p]=await FetchTranscations(t,c,"Sale",a),!s)return[!1];if(t!=c[0])return[!0,!0];v=p,G=a}if(e=="Asset"||e=="Place"){const f={},S=[],k=v||p;for(let L=0;L<k.length;L++){const C=k[L],x=e=="Place"&&C?.details?.place?.universeId||C.details.id||C?.details?.place?.universeId;if(!f[x]){let F=e=="Place"&&C?.details?.place;!F&&C.details.id==null&&(F=C?.details?.place);const M={Type:F&&"Place"||C?.details?.type=="GamePass"&&"GamePass"||C?.details?.type=="DeveloperProduct"&&"DeveloperProduct"||"Asset",Name:F?.name&&`${F.name}${e=="Asset"&&" (Private Servers)"||""}`||C.details.name,Id:x,Robux:0,Place:F};S.push(M),f[x]=M}f[x].Robux+=C.currency.amount}n=S}else if(e=="User"){const f={},S=[],k=v||p;for(let L=0;L<k.length;L++){const C=k[L],x=C.agent.id;if(!f[x]){const F={Type:"User",Name:C.agent.name,Id:x,Robux:0};S.push(F),f[x]=F}f[x].Robux+=C.currency.amount}n=S}return n.sort(function(f,S){return S.Robux-f.Robux}),await AddIcons(n),t!=c[0]?[!0,!0]:[!0,!1,n]}let N=0,g=0,D="",R;function b(e){return N!==a||D!==e}async function y(e){if(N==a&&D==e)return[!0,!0];m[0]++,D=e;const t=m[0];let s,n,p;if(!R||g!=a){if([s,n,p]=await FetchTranscations(t,m,"AffiliateSale",a),!s)return[!1];if(t!=m[0])return[!0,!0];R=p,g=a}if(e=="Asset"){const f={},S=[],k=R||p;for(let L=0;L<k.length;L++){const C=k[L],x=C.details.id;if(!f[x]){const F={Type:"Asset",Name:C.details.name,Id:x,Robux:0};S.push(F),f[x]=F}f[x].Robux+=C.currency.amount}n=S}else if(e=="User"){const f={},S=[],k=R||p;for(let L=0;L<k.length;L++){const C=k[L],x=C.agent.id;if(!f[x]){const F={Type:"User",Name:C.agent.name,Id:x,Robux:0};S.push(F),f[x]=F}f[x].Robux+=C.currency.amount}n=S}return n.sort(function(f,S){return S.Robux-f.Robux}),await AddIcons(n),t!=m[0]?[!0,!0]:[!0,!1,n]}if(A=="users"){const e=await WaitForClass("user-transactions-container");ChildAdded(e,!0,async function(t){if(t.className!=="summary")return;for(;t.children.length===0;)await sleep(20);const s=t.getElementsByTagName("tbody")[0];a=86400*30,i[0]++,o[0]++,c[0]++,m[0]++,CreateDetailedSummary(await WaitForTableRow(s,"Group Payouts"),d,h),CreateDetailedSummary(await WaitForTableRow(s,"Premium Payouts"),U,T),CreateDetailedSummary(await WaitForTableRow(s,"Sales of Goods"),E,P,["Place","Asset","User"],c,SalesOfGoodsCSV,ParseCSVSalesOfGoods),CreateDetailedSummary(await WaitForTableRow(s,"Commissions"),y,b,["Asset","User"])})}else WaitForClass("tab-content configure-group-details").then(function(e){ChildAdded(e,!0,async function(t){if(t.nodeType!==Node.ELEMENT_NODE||t.tagName.toLowerCase()!=="revenue-summary")return;const s=await WaitForClassPath(t,"table section-content"),n=await WaitForTagPath(s,"tbody");CreateDetailedSummary(await WaitForTableRow(n,"Sale of Goods"),E,P,["Place","Asset","User"],c,SalesOfGoodsCSV,ParseCSVSalesOfGoods)})})}),KillAllCaches();

//# sourceMappingURL=https://roqol.io/assets/sourcemap/chrome/2.33.1/js/pages/economy/summary.js