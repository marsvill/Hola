const PreventDuplicateScript_246=0;function CreateSliderOption(o,a,r,u,m){const e=document.createElement("div");e.className="theme-option",e.innerHTML='<h3></h3><div style="display: flex; justify-content: center;"><input type="range" class="slider" max=""><div class="current-input-label"></div></div>',e.getElementsByTagName("input")[0].setAttribute("max",a),e.getElementsByTagName("h3")[0].innerText=o;const f=e.getElementsByClassName("current-input-label")[0],d=e.getElementsByClassName("slider")[0];return d.value=r,d.addEventListener("input",async function(){f.innerText=m(await u(d.value))}),f.innerText=m(r),e}function CreateDropdownOption(o,a,r,u,m){const e=document.createElement("div");e.className="theme-option",e.innerHTML='<h3></h3><div style="display: flex; justify-content: center;"><select class="input-field select-option rbx-select"><span class="icon-arrow icon-down-16x16"></span></div>',e.getElementsByTagName("h3")[0].innerText=o;const f=e.getElementsByClassName("input-field")[0];for(let d=0;d<a.length;d++){const y=document.createElement("option");y.value=a[d],y.innerText=m(a[d]),f.appendChild(y)}return f.value=r,f.addEventListener("change",async function(){await u(f.value)}),e}function CreateSettingsSection(){const o=document.createElement("div");return o.style="margin: 50px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center;",IsFeatureEnabled("CurrentTheme").then(function(a){a.Settings||(a.Settings={});function r(e,f){const d=a.Settings[e];return d!==void 0?d:f}const u=CreateSliderOption("Theme Blur",20,r("Blur",0),function(e){return a.Settings.Blur=e,chrome.runtime.sendMessage({type:"ThemeSettings",key:"Blur",value:e}),e},function(e){return`${e}px`}),m=document.createElement("span");m.className="error",m.innerHTML='<span class="icon-warning"></span>This will lag weak devices',u.appendChild(m),o.append(u),o.append(CreateSliderOption("Foreground Opacity",100,Math.round(r("Opacity",1)*100),function(e){return a.Settings.Opacity=e/100,chrome.runtime.sendMessage({type:"ThemeSettings",key:"Opacity",value:e/100}),e},function(e){return`${e}%`})),o.append(CreateSliderOption("Brightness",100,Math.round(r("Brightness",1)*100),function(e){return a.Settings.Brightness=e/100,chrome.runtime.sendMessage({type:"ThemeSettings",key:"Brightness",value:e/100}),e},function(e){return`${e}%`})),o.append(CreateSliderOption("Saturation",100,Math.round(r("Saturation",1)*100),function(e){return a.Settings.Saturation=e/100,chrome.runtime.sendMessage({type:"ThemeSettings",key:"Saturation",value:e/100}),e},function(e){return`${e}%`})),o.append(CreateDropdownOption("Image Repeat",["no-repeat","repeat","repeat-x","repeat-y","round","space"],a.Settings.BackgroundRepeat||"repeat",function(e){return a.Settings.BackgroundRepeat=e,chrome.runtime.sendMessage({type:"ThemeSettings",key:"BackgroundRepeat",value:e}),e},function(e){return e})),o.append(CreateDropdownOption("Video Fit",["cover","contain","fixed","fill","none","scale-down"],a.Settings.VideoFit||"cover",function(e){return a.Settings.VideoFit=e,chrome.runtime.sendMessage({type:"ThemeSettings",key:"VideoFit",value:e}),e},function(e){return e}))}),o}async function WaitForThemeUploadFinish(o){if(o.PollingUrl)for(;;){const[a,r]=await RequestFunc(o.PollingUrl,"GET");if(!a||r.Completed)break;await sleep(1e3)}}async function UploadThemeToAWSViaBackground(o,a,r,u,m){return await chrome.runtime.sendMessage({type:"UploadTheme",URL:o,Method:a,Headers:r,Fields:u,File:Array.from(new Uint8Array(await m.arrayBuffer()))})}async function UploadTheme(o,a,r,u){u("Requesting upload url");const[m,e,f]=await RequestFunc(WebServerEndpoints.ThemesV2+"custom/upload","POST",{"Content-Type":"application/json"},JSON.stringify({Size:r,Type:a}));if(!m)return[m,e,f];if(e.Urls){const x=[],I=new Blob([o]),U=e.ChunkSize,h=[];let v=0;for(let g=0;g<e.Urls.length;g++){const E=g,w=e.Urls[E],F=E*U,N=UploadThemeToAWSViaBackground(w,"PUT",{"Content-Type":a},void 0,I.slice(F,F+U));N.then(function([B,W,L]){if(B){const P=parseInt(new URLSearchParams(w.split("?")[1]).get("partNumber"));h[E]={tag:L.headers.Etag,partNumber:P},v++,u(`Uploading ${v}/${e.ChunkCount}`)}}),x.push(N)}u(`Uploading 0/${e.ChunkCount}`);const b=await Promise.all(x);for(let g=0;g<b.length;g++){const[E,w,F]=b[g];if(!E)return[E,w,F]}u("Completing Upload");const k={FileKey:e.FileKey,UploadId:e.UploadId,Etags:h},[M,S,T]=await RequestFunc(WebServerEndpoints.ThemesV2+"custom/upload/multipart","POST",{"Content-Type":"application/json"},JSON.stringify(k));return M?(u("Waiting for file to be processed"),await WaitForThemeUploadFinish(e),[m,e,f]):[M,S,T]}u("Uploading");const[d,y,R]=await UploadThemeToAWSViaBackground(e.UploadUrl,"POST",void 0,e.Fields,new Blob([o]));return d?(u("Waiting for file to be processed"),await WaitForThemeUploadFinish(e),[m,e,f]):[d,y,R]}async function CreateThemesSection(o){const a=document.createElement("div");a.style="display: flex; justify-content: center; margin-bottom: 16px;";const r=document.createElement("div");r.innerHTML=`<div class="ThemeUploadContainer"><label tabindex="0" type="button"><input type="file" style="display: none;" class="customThemeUpload"><span>Upload Custom Theme</span><span class="ThemeUploadRipple"></span></label><span class="spinner spinner-default" style="display: none;"></span><span class="upload-subtitle status" style="display: none;"></span><span class="upload-subtitle error" style="color: rgba(247,75,82,255); display: none;"><span class="icon-warning"></span></span></div>
    
    <div class="modal-btns" style="display:none;justify-content:center;">
        <a class="btn-control-md cancel-upload-btn" style="margin: 6px;">Cancel</a>
        <a class="btn-primary-md confirm-upload-btn" style="margin: 6px;">Upload</a>
    </div>
    `;const u=r.getElementsByClassName("modal-btns")[0],m=r.getElementsByClassName("confirm-upload-btn")[0],e=r.getElementsByClassName("cancel-upload-btn")[0],f=r.getElementsByClassName("ThemeUploadContainer")[0],d=r.getElementsByClassName("customThemeUpload")[0],y=r.getElementsByClassName("upload-subtitle error")[0],R=r.getElementsByClassName("upload-subtitle status")[0],x=document.createTextNode(""),I=r.getElementsByClassName("spinner")[0];y.appendChild(x),PaidForFeature("CurrentTheme").then(function(t){t||(d.style="pointer-events: none; cursor: pointer; display: none;",d.addEventListener("click",CreatePaymentPrompt))});function U(t){const n=document.createElement("span");return n.className="upload-subtitle",n.innerText=t,f.appendChild(n),n}RequestFunc(WebServerEndpoints.ThemesV2+"custom/metadata","GET").then(function([t,n]){if(!t){U("Failed to fetch metadata").style.color="rgba(247,75,82,255)";return}let s="";for(let l=0;l<n.Accept.length;l++){const c=n.Accept[l];s!=""&&(s+=","),s+=c}d.setAttribute("accept",s);let i="";for(let l=0;l<n.Allowed.length;l++){const c=n.Allowed[l];i!=""&&(i+=", "),i+=c}U("Allowed: "+i),U(`Image: ${n.MaxFileSizes.image} max, Video: ${n.MaxFileSizes.video} max`)});let h,v;const b={};async function k(t){if(b[t])return b[t];const[n,s,i]=await RequestFunc(WebServerEndpoints.ThemesV2+"preview?type="+encodeURIComponent(t),"GET",void 0,void 0,void 0,!0);if(n)return b[t]=await i.text(),b[t]}const M=t=>new Promise((n,s)=>{const i=new FileReader;i.onloadend=()=>n(i.result),i.onerror=s,i.readAsDataURL(t)});async function S(){if(u.style.display="none",v&&URL.revokeObjectURL(v),v=void 0,!h){UpdateTheme(await IsFeatureEnabled("CurrentTheme"));return}u.style.display="flex";const t=await k(h.fileType);if(!t){y.innerText="Failed to preview",y.style.display="",h=void 0,S();return}const n=new Blob([h.target.result],{type:h.fileType});v=URL.createObjectURL(new Blob([t.replace("'URL'",await M(n))],{type:"text/html"})),UpdateTheme({Access:v,Type:h.fileType.includes("video")?"video":"image",Settings:(await IsFeatureEnabled("CurrentTheme")).Settings||{},Theme:"custom"})}e.addEventListener("click",function(){h=void 0,S()}),m.addEventListener("click",async function(){const t=h;h=void 0,S(),y.style.display="none",I.style.display="",R.style.display="";const[n,s,i]=await UploadTheme(t.target.result,t.fileType,t.target.result.byteLength,function(l){R.innerText=l});if(R.style.display="none",!n){x.nodeValue=s?.Result!="???"?s.Result:i?.statusText||"Internal Error",y.style.display="",I.style.display="none",s.FileKey&&RequestFunc(WebServerEndpoints.ThemesV2+"custom/upload/fail","POST",{"Content-Type":"application/json"},JSON.stringify({FileKey:s.FileKey,UploadId:s.UploadId}));return}I.style.display="none",SetFeatureEnabled("CurrentTheme",s.Theme)}),d.addEventListener("change",function(t){const n=t.target.files[0];if(!n)return;let s=new FileReader;s.onload=async function(i){i.fileType=n.type,h=i,S()},s.readAsArrayBuffer(n)}),a.appendChild(r);const T=document.createElement("div");T.className="themes-list";const g=[];let E=!1;function w(t,n){if(E){t.src=n;return}g.push([t,n])}o.addEventListener("RobloxQoL.Opened",function(){E=!0;for(let t=0;t<g.length;t++){const[n,s]=g[t];n.src=s}});function F(t,n,s,i){const l=i?"video":"image";return`${WebServerEndpoints.ThemesV2}theme?theme=${t}${s?"&preview=true":""}${s&&n==="video"?"&previewType="+l:""}`}function N(t,n,s,i){const l=document.createElement("a");l.className="theme";const c=document.createElement("a");c.className="theme-button";const C=document.createElement("iframe");if(C.className="theme-frame",!i&&s&&window.addEventListener("message",function(p){p.source===C.contentWindow&&p.data.type==="theme-iframe-ready"&&C.contentWindow.postMessage({css:{"background-position":"center","background-repeat":"","background-size":"cover"}},"*")}),n==="video"){const p=document.createElement("img");p.src=chrome.runtime.getURL("img/video.svg"),p.className="video-icon",l.appendChild(p)}if(t.includes("http")?w(C,t):w(C,F(t,n,s,!1)),C.style="width: 100%; height: 100%",l.append(c,C),T.appendChild(l),!i){c.addEventListener("click",async function($){if(!await PaidForFeature("CurrentTheme")){CreatePaymentPrompt();return}const A=await IsFeatureEnabled("CurrentTheme");A?.Theme!==t&&(A.Theme=t,A.Type=n,SetFeatureEnabled("CurrentTheme",A))});let p;s&&(c.addEventListener("mouseenter",function(){if(p){p.contentWindow.postMessage({paused:!1},"*"),p.style.display="";return}p=document.createElement("iframe"),p.className="theme-frame",p.style="pointer-events: none; height: 200px!important; width: 150px!important; position: absolute;",p.src=F(t,n,s,!0),l.insertBefore(p,C)}),c.addEventListener("mouseleave",function(){p&&(p.contentWindow.postMessage({paused:!0},"*"),p.style.display="none")}))}return[l,c]}const B=document.createElement("a"),W=document.createElement("img");W.src=chrome.runtime.getURL("img/whitecross.svg"),B.className="theme clear-button",B.appendChild(W),B.addEventListener("click",async function(){const t=await IsFeatureEnabled("CurrentTheme");t.Theme=void 0,SetFeatureEnabled("CurrentTheme",t)}),T.appendChild(B),RequestFunc(WebServerEndpoints.ThemesV3,"GET").then(function([t,n]){if(!t){T.innerText="An error occurred";return}for(let s=0;s<n.length;s++)N(n[s].Name,n[s].Type,n[s].Preview)});let L;function P(t){const[n,s]=N(t.Access,t.FileType,!1,!0);T.insertBefore(n,T.children[1]),L=n;const i=document.createElement("a"),l=document.createElement("img");l.style="width: 100%; height: 100%;",l.src=chrome.runtime.getURL("img/filters/clearfilter.png"),i.appendChild(l),i.style="position: absolute; height: 25px; margin: 8px; z-index: 5;",n.insertBefore(i,n.children[0]),i.addEventListener("click",async function(){RequestFunc(WebServerEndpoints.ThemesV2+"custom","DELETE"),n.remove(),L=void 0;const c=await IsFeatureEnabled("CurrentTheme");c&&c.Theme==="custom"&&(c.Theme=void 0,SetFeatureEnabled("CurrentTheme",c))}),s.addEventListener("click",async function(){if(!await PaidForFeature("CurrentTheme"))return CreatePaymentPrompt();const c=await IsFeatureEnabled("CurrentTheme");c?.Theme!=="custom"&&(c.Theme="custom",c.Type=c.FileType,SetFeatureEnabled("CurrentTheme",c))})}let O;IsFeatureEnabled("CurrentTheme").then(function(t){!t||!t.Access||(O=t.Access,P(t))}),ListenToEventFromBackground("ThemeChange",function(t){const n=t.Theme;h=void 0,S(),n?.Access!=O&&(O=n.Access,L&&L.remove(),n&&P(n))}),o.append(a,CreateSettingsSection(),T)}

//# sourceMappingURL=https://roqol.io/assets/sourcemap/chrome/2.33.1/js/pages/settings/themes.js