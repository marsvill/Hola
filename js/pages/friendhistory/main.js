const PreventDuplicateScript_149=0;let CurrentPage=1,CurrentHistoryElements=[],HistoryHeaderTab,OriginalFriendsCount,OpenConnections=[];function ModifyHeaderTab(t){t.className==="rbx-tab"&&(t.style="min-width: 20%;",t.getAttribute("custom")||(t.getElementsByTagName("a")[0].className="rbx-tab-heading"))}function RemoveOriginalFriendElement(t){t.className==="list-item avatar-card"&&!t.getAttribute("custom")&&(t.style="display:none;")}const FriendsListMutationObserver=new MutationObserver(function(t){t.forEach(function(n){if(n.type=="childList"){const i=n.addedNodes;for(let o=0;o<i.length;o++)RemoveOriginalFriendElement(i[o])}})}),TabWidthMutationObserver=new MutationObserver(function(t){t.forEach(function(n){if(n.type=="childList"){const i=n.addedNodes;for(let o=0;o<i.length;o++)ModifyHeaderTab(i[o])}})});function AddConnection(t,n,i){return OpenConnections.push({Callback:t,Type:n,Element:i}),t}async function HandleTabModification(){const t=await WaitForClass("nav nav-tabs");ChildAdded(t,!0,ModifyHeaderTab);const[n,i]=CreateHeaderTab("History","history","#!/friends?tab=history",IsHistoryTabOpen());t.appendChild(n),HistoryHeaderTab=i}function IsHistoryTabOpen(){return window.location.href.search("tab=history")>-1}function CreateFromFriendHistory(t,n){const i=CreateFriend(t.Id,t.Name,t.DisplayName,t.Image,t.Type,t.FriendedTimestamp,t.UnfriendedTimestamp,t.Verified);CurrentHistoryElements.push(i),n.appendChild(i)}async function AddNamesToHistory(t){const n=[],i={};for(let s=0;s<t.length;s++){const e=t[s];e.Name||(i[e.Id]||(i[e.Id]=[]),n.push(e.Id),i[e.Id].push(e))}if(n.length===0)return;const[o,l]=await RequestFunc("https://users.roblox.com/v1/users","POST",{"Content-Type":"application/json"},JSON.stringify({userIds:n,excludeBannedUsers:!1}));if(!o){for(const[s,e]of Object.entries(i))for(let a=0;a<e.length;a++){const r=e[a];r.Name="???",r.DisplayName="???"}return}const d=l.data;for(let s=0;s<d.length;s++){const e=d[s],a=i[e.id];for(let r=0;r<a.length;r++){const c=a[r];c.Name=e.name,c.DisplayName=e.displayName,c.Verified=e.hasVerifiedBadge}delete i[e.id]}for(const[s,e]of Object.entries(i))for(let a=0;a<e.length;a++){const r=e[a];r.DisplayName="Terminated",r.Name=s}}async function AddImagesToHistory(t){const n=[],i={};for(let s=0;s<t.length;s++){const e=t[s];e.Image||(i[e.Id]||(i[e.Id]=[]),i[e.Id].push(e),n.push({requestId:e.Id,targetId:e.Id,type:2,size:"150x150",format:"Png",isCircular:!0}))}if(n.length===0)return;const[o,l]=await RequestFunc("https://thumbnails.roblox.com/v1/batch","POST",{"Content-Type":"application/json"},JSON.stringify(n),!0);if(!o){for(const[s,e]of Object.entries(i))for(let a=0;a<e.length;a++)e[a].Image="https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/150/150/Image/Png";return}const d=l.data;for(let s=0;s<d.length;s++){const e=d[s],a=i[e.targetId];for(let r=0;r<a.length;r++){const c=a[r];e.state==="Completed"?c.Image=e.imageUrl:c.Image="https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/150/150/Image/Png"}}}async function HandleHistoryPage(){await sleep(100);const t=await WaitForClass("btn-generic-left-sm"),n=await WaitForClass("btn-generic-right-sm"),i=await WaitForId("rbx-current-page"),o=await WaitForClass("hlist avatar-cards");function l(e,a){const r=a&&"enabled"||"disabled",c=!a&&"enabled"||"disabled";e.removeAttribute(c),e.setAttribute(r,r)}async function d(){await sleep(50),l(t,!1),l(n,!1);for(let c=0;c<CurrentHistoryElements.length;c++)CurrentHistoryElements[c].remove();CurrentHistoryElements=[];const[e,a,r]=await LoadPage(CurrentPage);await Promise.all([AddNamesToHistory(e),AddImagesToHistory(e)]);for(let c=0;c<e.length;c++)CreateFromFriendHistory(e[c],o);await sleep(50),l(t,CurrentPage>1),l(n,a),i.innerText=CurrentPage,WaitForClass("friends-subtitle").then(function(c){let f=c.childNodes[2],u=c.childNodes[0];OriginalFriendsCount||(OriginalFriendsCount=f.data),u.data="All Friends",f.data=`(${r}${r>=200?"+":""})`})}n.addEventListener("click",AddConnection(function(){CurrentPage++,d()},"click",n)),t.addEventListener("click",AddConnection(function(){CurrentPage--,d()},"click",t)),d(),FriendsListMutationObserver.observe(o,{childList:!0});const s=o.children;for(let e=0;e<s.length;e++)RemoveOriginalFriendElement(s[e])}function CheckIfHistoryTabOpened(){const t=IsHistoryTabOpen();if(WaitForClass("friends-filter-status input-group-btn dropdown btn-group").then(function(n){n.style=t&&"display:none;"||""}),WaitForClass("friends-filter").then(function(n){n.style=t&&"display:none;"||""}),t&&WaitForId("friends").then(function(n){n.getElementsByTagName("a")[0].className="rbx-tab-heading"}),HistoryHeaderTab.className=`rbx-tab-heading${t&&" active"||""}`,!t){FriendsListMutationObserver.disconnect();for(let n=0;n<CurrentHistoryElements.length;n++)CurrentHistoryElements[n].remove();CurrentHistoryElements=[];for(let n=0;n<OpenConnections.length;n++){const i=OpenConnections[n];i.Element.removeEventListener(i.Type,i.Callback)}OpenConnections=[],WaitForClass("hlist avatar-cards").then(function(n){const i=n.children;for(let o=0;o<i.length;o++)i[o].style=""}),WaitForClass("friends-subtitle").then(function(n){let i=n.childNodes[2],o=n.childNodes[0];o.data="Friends",OriginalFriendsCount&&(i.data=OriginalFriendsCount)});return}HandleHistoryPage()}window.addEventListener("popstate",CheckIfHistoryTabOpened),IsFeatureEnabled("FriendHistory").then(async function(t){t&&(await HandleTabModification(),CheckIfHistoryTabOpened())});

//# sourceMappingURL=https://roqol.io/assets/sourcemap/chrome/2.33.1/js/pages/friendhistory/main.js