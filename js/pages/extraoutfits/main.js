const PreventDuplicateScript_137=0;let FetchedAllExtraOutfits=!1,IsFetchingAllExtraOutfits=!1,CostumesList,PreviousExtraOutfitButton,ExtraOutfitsElements=[],CurrentExtraOutfitsInfo={},IsCustomesOpen=!1,CustomesOpenInt=0;const LayeredOrderLookup={70:3,71:3,66:4,69:5,72:6,64:7,65:8,68:9,67:10,41:11};function IsCustomesListOpen(){return CostumesList.className=="tab-pane ng-scope active"&&document.getElementsByClassName("btn-secondary-xs btn-float-right ng-binding ng-scope")[0]&&document.querySelectorAll('[ng-click="createOutfitClicked()"]').length>0}async function RedrawCharacter(){document.dispatchEvent(new CustomEvent("RedrawThumbnail"))}function IsInputValid(e,i){return new RegExp(e.getAttribute("ng-pattern"),"i").test(i)}async function GetCurrentOutfit(){return await RequestFunc("https://avatar.roblox.com/v2/avatar/avatar","GET",void 0,void 0,!0)}async function GetAvatarImage(){const[e,i]=await RequestFunc(`https://thumbnails.roblox.com/v1/users/avatar?userIds=${UserId}&size=150x150&format=Png&isCircular=false`,"GET");return e?[!0,i.data[0].imageUrl]:[e,i]}async function SaveCurrentOutfit(e){const[i,t]=await GetCurrentOutfit();if(!i)return CreateAlert(t.Result,!1),[i,t];const[s,o]=await GenerateExtraOutfitThumbnail(t);return await RequestFunc(WebServerEndpoints.OutfitsV2+"save","POST",{"Content-Type":"application/json"},JSON.stringify({Name:e,Outfit:t,Image:s&&o||"https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/420/420/Image/Png"}))}function GetOutfitIdAndImageFromOutfitCard(e){return SpanThumbnailContainer=e.getElementsByTagName("div")[0].getElementsByClassName("item-card-container remove-panel outfit-card")[0].getElementsByClassName("item-card-link")[0].getElementsByClassName("item-card-thumb-container")[0].getElementsByClassName("item-card-thumb ng-isolate-scope")[0].getElementsByClassName("thumbnail-2d-container")[0],OutfitId=SpanThumbnailContainer.getAttribute("thumbnail-target-id"),ImageURL=SpanThumbnailContainer.getElementsByClassName("ng-scope ng-isolate-scope")[0].src,[OutfitId,ImageURL]}async function GetExtraOutfits(){const[e,i]=await RequestFunc(WebServerEndpoints.Outfits,"GET");return e?[!0,i]:(CreateAlert(i.Result,!1),[!1,i])}async function GetExtraOutfit(e){const[i,t]=await RequestFunc(WebServerEndpoints.OutfitsV2+"wear/"+e,"GET");return[i,t]}function AlertControllerOfAvatarChange(){document.dispatchEvent(new CustomEvent("RoQoL.AlertControllerOfAvatarChange"))}async function WearExtraOutfit(e){const[i,t]=await GetExtraOutfit(e);if(!i)return CreateAlert(t.Result,!1),[!1,t];let s=[];const o=t.assets,p=t.assetsMeta;for(let u=0;u<o.length;u++)s.push({id:o[u]});if(p)for(let u=0;u<p.length;u++){const l=p[u],r=l.assetId;delete l.assetId,s.push({id:r,meta:l})}AllPromises=[];const b=[],h={};let O=!1;const v=[],C=[];C.push(await RequestFunc("https://avatar.roblox.com/v2/avatar/set-body-colors","POST",{"Content-Type":"application/json"},JSON.stringify(t.bodyColor3s),!0)),C.push(await RequestFunc("https://avatar.roblox.com/v1/avatar/set-player-avatar-type","POST",{"Content-Type":"application/json"},JSON.stringify({playerAvatarType:t.rigType}),!0)),C.push(await RequestFunc("https://avatar.roblox.com/v1/avatar/set-scales","POST",{"Content-Type":"application/json"},JSON.stringify(t.scales),!0)),await sleep(100),C.push(await RequestFunc("https://avatar.roblox.com/v2/avatar/set-wearing-assets","POST",{"Content-Type":"application/json"},JSON.stringify({assets:s}),!0));for(let u=0;u<C.length;u++){const l=C[u][2];let r=C[u][1];if(l.url=="https://avatar.roblox.com/v2/avatar/set-wearing-assets"&&(!l.ok||!r.success)){let n=r?.ValidationErrors||r?.errors?.[0]?.message;if(!n){const a=r?.invalidAssetIds;if(a&&!r.success){O=!0;for(let c=0;c<a.length;c++)v.push(a[c]),h[a[c]]=!0}break}typeof n=="string"&&(n=JSON.parse(n)?.ValidationErrors);for(let a=0;a<n.length;a++){const c=n[a];c.Code==3&&b.push(parseInt(c.FieldData))}}}if(O||b.length>0){s=[];const u=[];for(let r=0;r<b.length;r++){const n=b[r];h[n]||(o.splice(o.indexOf(n)),u.push({itemType:1,id:n}))}for(let r=0;r<o.length;r++)h[o[r]]||s.push({id:o[r]});if(u.length>0){const[r,n]=await RequestFunc("https://catalog.roblox.com/v1/catalog/items/details","POST",{"Content-Type":"application/json"},JSON.stringify({items:u}));if(!r){CreateAlert("Some of your costume failed to wear",!1),RedrawCharacter(),AlertControllerOfAvatarChange();return}const a=n.data;for(let c=0;c<a.length;c++){const f=a[c];s.push({id:f.id,meta:{order:LayeredOrderLookup[f.assetType],version:1}})}}const[l]=await RequestFunc("https://avatar.roblox.com/v2/avatar/set-wearing-assets","POST",{"Content-Type":"application/json"},JSON.stringify({assets:s}),!0);if(!l){CreateAlert("Some of your costume failed to wear",!1),RedrawCharacter(),AlertControllerOfAvatarChange();return}}O?CreateAlert(`Wore costume, however you do not own ${v.join(", ")}!`,!0):CreateAlert("Successfully wore costume",!0),RedrawCharacter(),AlertControllerOfAvatarChange()}function CreateExtraOutfitButton(e){if(e.Id==0)return;const[i,t,s,o,p,b,h,O,v,C,u]=CreateOutfitElement(e.Name,e.Image,e.Id);let l=!1;function r(){O.className=`item-card-menu ng-scope ng-isolate-scope${l&&" active"||""}`}b.addEventListener("click",function(){WearExtraOutfit(e.Id)}),s.addEventListener("click",function(){const[n,a,c,f,m,I]=CreateOutfitModalWindow("Rename Costume","Choose a new name for your costume.","Name your costume","Rename","Cancel");c.addEventListener("click",function(){n.remove(),a.remove()}),f.addEventListener("click",function(){n.remove(),a.remove()}),m.addEventListener("click",async function(){l=!1,r();let d=I.value;if(IsInputValid(I,d)){n.remove(),a.remove();const[g,y]=await RequestFunc(WebServerEndpoints.Outfits+"rename","PATCH",void 0,JSON.stringify({Id:e.Id,Name:d}));g?(C.innerText=d,b.setAttribute("data-item-name",d),u.setAttribute("data-item-name",d),CreateAlert("Renamed costume",!0)):CreateAlert(y.Result,!1)}}),I.addEventListener("input",function(){let d=IsInputValid(I,I.value)&&"enabled"||"disabled",g=d&&"enabled"||"disabled",y=!d&&"enabled"||"disabled";m.setAttribute(g,g),m.removeAttribute(y)})}),o.addEventListener("click",async function(){l=!1,r();const[n,a,c,f,m,I]=CreateOutfitModalWindow("Delete Costume","Are you sure you want to delete this costume?",void 0,"Delete","Cancel");m.addEventListener("click",async function(){n.remove(),a.remove();const[d,g]=await RequestFunc(WebServerEndpoints.Outfits+"delete/"+e.Id,"DELETE");d?(i.remove(),CreateAlert("Removed costume",!0),CurrentExtraOutfitsInfo[e.Id]=null):CreateAlert(g.Result,!1)}),f.addEventListener("click",function(){n.remove(),a.remove()}),c.addEventListener("click",function(){n.remove(),a.remove()}),m.setAttribute("enabled","enabled"),m.removeAttribute("disabled")}),t.addEventListener("click",async function(){l=!1,r();const[n,a,c,f,m,I]=CreateOutfitModalWindow("Update Costume","Do you want to update this costume? This will overwrite the costume with your avatar's current appearance.",void 0,"Update","Cancel");m.addEventListener("click",async function(){n.remove(),a.remove();const[d,g]=await GetCurrentOutfit();if(!d)return[d,g];const[y,E]=await GetAvatarImage(),[S,w]=await RequestFunc(WebServerEndpoints.OutfitsV2+"update","PUT",{"Content-Type":"application/json"},JSON.stringify({Id:e.Id,Name:e.Name,Outfit:g,Image:y&&E||"https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/420/420/Image/Png"}));S?(v.setAttribute("ng-src",y&&E||"https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/420/420/Image/Png"),v.src=y&&E||"https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/420/420/Image/Png",CreateAlert("Updated costume",!0)):CreateAlert(w.Result,!1)}),f.addEventListener("click",function(){n.remove(),a.remove()}),c.addEventListener("click",function(){n.remove(),a.remove()}),m.setAttribute("enabled","enabled"),m.removeAttribute("disabled")}),h.addEventListener("click",function(){l=!l,r()}),p.addEventListener("click",function(){l=!1,r()}),v.onerror=async function(n){v.onerror=null;const[a,c,f]=await RequestFunc(v.src,"GET",void 0,void 0,!1,!0);!a&&(f.status===400||f.status===404)&&(v.src=await QueueRegenerateExtraOutfitThumbnail(e.Id))},ItemCardsList.insertBefore(i,ItemCardsList.firstChild)}async function CustomesOpened(){CustomesOpenInt++,PreviousExtraOutfitButton=CreateButton(),PreviousExtraOutfitButton.addEventListener("click",function(){[ModalWindow,Backdrop,CloseButton,CancelButton,CreateOutfitButton,Input]=CreateOutfitModalWindow("Create Extra Costume","A costume will be created from your avatar's current appearance.","Name your costume","Create","Cancel");function t(){ModalWindow.remove(),Backdrop.remove()}CloseButton.addEventListener("click",t),CancelButton.addEventListener("click",t),CreateOutfitButton.addEventListener("click",async function(){t();let s=Input.value;if(IsInputValid(Input,s)){const[o,p]=await SaveCurrentOutfit(s);o&&(CurrentExtraOutfitsInfo[p.Id]=p,CreateExtraOutfitButton(p))}}),Input.addEventListener("input",function(){let s=IsInputValid(Input,Input.value)&&"enabled"||"disabled",o=s==="disabled"&&"enabled"||"disabled";CreateOutfitButton.setAttribute(s,s),CreateOutfitButton.removeAttribute(o)}),Input.focus()}),ItemCardsList=CostumesList.getElementsByTagName("div")[1].getElementsByTagName("div")[0].getElementsByTagName("ul")[0],CacheCustomesOpenInt=CustomesOpenInt;const[e,i]=await GetExtraOutfits();if(!(!e||CacheCustomesOpenInt!=CustomesOpenInt))for(let t=0;t<i.length;t++){const s=i[t];CurrentExtraOutfitsInfo[s.Id]=s,CreateExtraOutfitButton(s)}}const CustomesObserver=new MutationObserver(function(e,i){e.forEach(function(t){if(t.type==="attributes"&&t.attributeName==="class"||t.type==="childList"){let s=IsCustomesOpen;if(IsCustomesOpen=IsCustomesListOpen(),s===IsCustomesOpen)return;if(IsCustomesOpen)CustomesOpened();else{PreviousExtraOutfitButton&&(PreviousExtraOutfitButton.remove(),PreviousExtraOutfitButton=null);for(let o=0;o<ExtraOutfitsElements.length;o++)ExtraOutfitsElements[o].remove();ExtraOutfitsElements=[]}}})});IsFeatureEnabled("ExtraOutfits").then(async function(e){e&&(CostumesList=await WaitForId("costumes"),CustomesObserver.observe(CostumesList,{attributes:!0}),CustomesObserver.observe(CostumesList.getElementsByTagName("div")[0],{childList:!0}),StartConversion())});

//# sourceMappingURL=https://roqol.io/assets/sourcemap/chrome/2.33.1/js/pages/extraoutfits/main.js