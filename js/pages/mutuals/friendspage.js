const PreventDuplicateScript_204=0;let CurrentMutualsPage=1,CurrentMutualsElements=[],MutualHeaderTab,OriginalMutualsFriendsCount,OpenMutualConnections=[],AllMutuals;async function LoadMutualPage(t){if(!AllMutuals)for(;;){const[r,u]=await GetMutualFriends(GetTargetId());if(!r){await sleep(1e3);continue}AllMutuals=u.reverse();break}const e=[],n=t*18-18,i=Math.min(t*18,AllMutuals.length);for(let r=n;r<i;r++)e.push(AllMutuals[r]);return[e,AllMutuals.length>t*18,AllMutuals.length]}function ModifyMutualHeaderTab(t){t.className.includes("rbx-tab")&&(t.style="min-width: 25%;",t.getAttribute("custom")||(t.getElementsByTagName("a")[0].className="rbx-tab-heading"))}function RemoveOriginalFriendElement(t){t.className==="list-item avatar-card"&&!t.getAttribute("custom")&&(t.style="display:none;")}const MutualFriendsListMutationObserver=new MutationObserver(function(t){t.forEach(function(e){if(e.type=="childList"){const n=e.addedNodes;for(let i=0;i<n.length;i++)RemoveOriginalFriendElement(n[i])}})});function AddConnection(t,e,n){return OpenMutualConnections.push({Callback:t,Type:e,Element:n}),t}async function HandleMutualTabModification(){const t=await WaitForClass("nav nav-tabs");ChildAdded(t,!0,ModifyMutualHeaderTab);const[e,n]=CreateHeaderTab("Mutuals","mutuals","#!/friends?tab=mutuals",IsMutualsTabOpen());t.appendChild(e),MutualHeaderTab=n}function IsMutualsTabOpen(){return window.location.href.search("tab=mutuals")>-1}function CreateFromFriendMutuals(t,e){const n=CreateFriend(t.id,t.name,t.displayName,t.Image,void 0,void 0,void 0,t.hasVerifiedBadge);CurrentMutualsElements.push(n),e.appendChild(n)}async function AddImagesToMutuals(t){const e=[],n={};for(let l=0;l<t.length;l++){const a=t[l];a.Image||(n[a.id]||(n[a.id]=[]),n[a.id].push(a),e.push({requestId:a.id,targetId:a.id,type:2,size:"150x150",format:"Png",isCircular:!0}))}if(e.length===0)return;const[i,r]=await RequestFunc("https://thumbnails.roblox.com/v1/batch","POST",{"Content-Type":"application/json"},JSON.stringify(e),!0);if(!i){for(const[l,a]of Object.entries(n))for(let o=0;o<a.length;o++)a[o].Image="https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/150/150/Image/Png";return}const u=r.data;for(let l=0;l<u.length;l++){const a=u[l],o=n[a.targetId];for(let c=0;c<o.length;c++){const s=o[c];a.state==="Completed"?s.Image=a.imageUrl:s.Image="https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/150/150/Image/Png"}}}async function HandleMutualsPage(){await sleep(100);const t=await WaitForClass("btn-generic-left-sm"),e=await WaitForClass("btn-generic-right-sm"),n=await WaitForId("rbx-current-page"),i=await WaitForClass("hlist avatar-cards");function r(a,o){const c=o&&"enabled"||"disabled",s=!o&&"enabled"||"disabled";a.removeAttribute(s),a.setAttribute(c,c)}async function u(){await sleep(50),r(t,!1),r(e,!1);for(let s=0;s<CurrentMutualsElements.length;s++)CurrentMutualsElements[s].remove();CurrentMutualsElements=[];const[a,o,c]=await LoadMutualPage(CurrentMutualsPage);await AddImagesToMutuals(a);for(let s=0;s<a.length;s++)CreateFromFriendMutuals(a[s],i);await sleep(50),r(t,CurrentMutualsPage>1),r(e,o),n.innerText=CurrentMutualsPage,WaitForClass("friends-subtitle").then(function(s){let d=s.childNodes[2],f=s.childNodes[0];OriginalMutualsFriendsCount||(OriginalMutualsFriendsCount=d.data),f.data="Mutuals",d.data=`(${c})`})}e.addEventListener("click",AddConnection(function(){CurrentMutualsPage++,u()},"click",e)),t.addEventListener("click",AddConnection(function(){CurrentMutualsPage--,u()},"click",t)),u(),MutualFriendsListMutationObserver.observe(i,{childList:!0});const l=i.children;for(let a=0;a<l.length;a++)RemoveOriginalFriendElement(l[a])}async function CheckIfMutualsTabOpened(){const t=IsMutualsTabOpen();for(WaitForClass("friends-filter-status input-group-btn dropdown btn-group").then(function(e){e.style=t&&"display:none;"||""}),WaitForClass("friends-filter").then(function(e){e.style=t&&"display:none;"||""});!MutualHeaderTab;)await sleep(100);if(MutualHeaderTab.className=`rbx-tab-heading${t&&" active"||""}`,!t){MutualFriendsListMutationObserver.disconnect();for(let e=0;e<CurrentMutualsElements.length;e++)CurrentMutualsElements[e].remove();CurrentMutualsElements=[];for(let e=0;e<OpenMutualConnections.length;e++){const n=OpenMutualConnections[e];n.Element.removeEventListener(n.Type,n.Callback)}OpenMutualConnections=[],WaitForClass("hlist avatar-cards").then(function(e){const n=e.children;for(let i=0;i<n.length;i++)n[i].style=""}),WaitForClass("friends-subtitle").then(function(e){let n=e.childNodes[2],i=e.childNodes[0];i.data="Friends",OriginalMutualsFriendsCount&&(n.data=OriginalMutualsFriendsCount)});return}HandleMutualsPage()}window.addEventListener("popstate",CheckIfMutualsTabOpened),IsFeatureEnabled("Mutuals2").then(async function(t){!t||await GetUserId()==GetTargetId()||!GetTargetId()||(await HandleMutualTabModification(),CheckIfMutualsTabOpened())});

//# sourceMappingURL=https://roqol.io/assets/sourcemap/chrome/2.33.1/js/pages/mutuals/friendspage.js