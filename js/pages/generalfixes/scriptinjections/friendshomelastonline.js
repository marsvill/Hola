const PreventDuplicateScript_188=0;let PendingLastOnlineBatches=[];function BatchGetLastOnline(y){return new Promise(async(w,h)=>{if(PendingLastOnlineBatches.push({UserId:y,resolve:w,reject:h}),PendingLastOnlineBatches.length===1){await new Promise(r=>setTimeout(r,100));const f=PendingLastOnlineBatches;PendingLastOnlineBatches=[];const p=[],l={};for(let r=0;r<f.length;r++){const o=f[r];l[o.UserId]||(p.push(o.UserId),l[o.UserId]=[]),l[o.UserId].push(o)}for(let r=0;r<3;r++){const o=await fetch("https://presence.roblox.com/v1/presence/last-online",{method:"POST",headers:{"Content-Type":"application-json"},body:JSON.stringify({userIds:p}),credentials:"include"}),c=o.ok;let m;if(c)try{m=await o.json()}catch{}if(!c){await new Promise(d=>setTimeout(d,1500));continue}const g=m.lastOnlineTimestamps;for(let d=0;d<g.length;d++){const t=g[d],e=l[t.userId];for(let n=0;n<e.length;n++)e[n].resolve(t.lastOnline)}return}for(const[r,o]of Object.entries(l))for(let c=0;c<o.length;c++)o[c].reject()}})}async function FriendsHomeLastOnline(){function y(t){const e=Math.floor(t/86400),n=Math.floor(t%(3600*24)/3600),i=Math.floor(t%3600/60),s=Math.floor(t%60);return e>0?`${e} day${e==1?"":"s"}`:n>0?`${n} hour${n==1?"":"s"}`:i>0?`${i} minute${i==1?"":"s"}`:`${s} second${s==1?"":"s"}`}function w(t){const e=t.getElementsByClassName("place-name")[0];if(e)return[e,!1];const n=document.createElement("div");return n.className="text-overflow xsmall text-label place-name",t.getElementsByClassName("friend-link")[0].appendChild(n),[n,!0]}const h={},f={};async function p(t,e,n){const i=new Date(await BatchGetLastOnline(t)),[s,u]=w(e);for(;h[t]===n;)s.innerText=y(Date.now()/1e3-i.getTime()/1e3)+" ago",await new Promise(a=>setTimeout(a,500));u&&s.remove()}function l(t){const e=t.userId||t.id,n=Date.now();h[e]=n,f[e]=t;const i=document.getElementById("people-"+e),s=document.getElementById("best-friend-"+e);i&&p(e,i,n),s&&p(e,s,n)}function r(t){const e=t.userId||t.id;f[e]=t,delete h[e]}let o=!1;function c(){const e=document.getElementById("best-friend-list-container")?.getElementsByClassName("hlist")[0];if(!e||o)return;o=!0;function n(s){const u=parseInt(s.getAttribute("rbx-user-id")),a=f[u];(a?.userPresenceType===0||a?.presence?.userPresenceType===0)&&l(a)}new MutationObserver(function(s){s.forEach(function(u){if(u.type==="childList")for(let a=0;a<u.addedNodes.length;a++)n(u.addedNodes[a])})}).observe(e,{childList:!0});const i=e.children;for(let s=0;s<i.length;s++)n(i[s])}document.addEventListener("RobloxQoL.BestFriendsLoaded",c),c(),document.addEventListener("Roblox.Presence.Update",async function(t){const e=t.detail[0];e.userPresenceType===0?l(e):r(e)});let m;for(;m=document.querySelector('[ng-controller="peopleListContainerController"]'),!m;)await new Promise(t=>setTimeout(t,100));const g=angular.element(m).scope();for(;g.library?.numOfFriends===null;)await new Promise(t=>setTimeout(t,100));function d(){for(const[t,e]of Object.entries(g.library.friendsDict))e.presence.userPresenceType===0?l(e):r(e)}d()}FriendsHomeLastOnline();

//# sourceMappingURL=https://roqol.io/assets/sourcemap/chrome/2.33.1/js/pages/generalfixes/scriptinjections/friendshomelastonline.js