const PreventDuplicateScript_240=0;let LoadMoreServersButton,DefaultLoadMoreServersButton,ClearFiltersButton,HiddenRefreshButton,RefreshButtonConn,IsFilterEnabled=!1,FilterInt=0,FirstEightServerElements=[],CurrentFilterFunction,CurrentFilterFunctionArgs;function CreateShowServersError(t){const e=document.getElementById("active-show-servers-error");e&&e.remove();const n=document.getElementById("rbx-game-server-item-container");if(n){const r=document.createElement("p");return r.id="active-show-servers-error",r.innerText=t,n.appendChild(r),r}return Paragraph}async function GetImageUrlsFromServer(t){const e=[],n={};for(let o=0;o<t.length;o++){const l=t[o],d=[];for(let u=0;u<l.players.length;u++)d.push(l.players[u].playerToken);const a=d.concat(l.playerTokens);n[l.id]=l;for(let u=0;u<a.length-d.length;u++){const m=a[u];e.push({requestId:`${l.id}/${m}`,token:m,type:"AvatarHeadShot",size:"150x150",format:"PNG",isCircular:!0})}}const r=SplitArrayIntoChunks(e,100),s=[];for(let o=0;o<r.length;o++)s.push(new Promise(async l=>{const[d,a]=await RequestFunc("https://thumbnails.roblox.com/v1/batch","POST",void 0,JSON.stringify(r[o]),!0);if(!d){l();return}const u=a.data;for(let m=0;m<u.length;m++){const g=u[m],c=g.requestId.split("/"),f=c[0],C=c[1],S=n[f];S.ImageUrls||(S.ImageUrls=[]),S.ImageUrls.push({imageUrl:g.imageUrl,token:C})}l()}));await Promise.all(s)}async function CreateServersFromRobloxServers(t){if(t.length===0)return;await GetImageUrlsFromServer(t);const e=await GetPlaceIdFromGamePage(),n=await WaitForId("rbx-game-server-item-container"),r=[];for(let s=0;s<t.length;s++){const o=await CreateServerBox(t[s],e);r.push(o),n.appendChild(o)}return r}async function ReplaceLoadMoreServersButton(){const t=await WaitForClass("rbx-running-games-footer"),e=FindClassPath(t,"rbx-running-games-load-more btn-control-md btn-full-width");e&&(DefaultLoadMoreServersButton?DefaultLoadMoreServersButton!==e?e.remove():e.style="display:none;":(DefaultLoadMoreServersButton=e,e.style="display:none;"));const n=document.createElement("button");return n.type="button",n.className="rbx-running-games-load-more btn-control-md btn-full-width",n.innerText="Load More",t.appendChild(n),LoadMoreServersButton=n,n}let SortSelect,FilterCheckbox,FakeOptions;async function GetRobloxSorts(){const t=await WaitForId("sort-select"),e=await WaitForId("filter-checkbox"),n=await WaitForClass("server-list-options");FakeOptions=n.cloneNode(!0),FakeOptions.style="display:none;",SortSelect=FakeOptions.querySelector("#sort-select"),FilterCheckbox=FakeOptions.querySelector("#filter-checkbox"),SortSelect.id="fake-sort-select",SortSelect.removeAttribute("disabled"),FilterCheckbox.id="fake-filter-checkbox",FilterCheckbox.removeAttribute("disabled"),FakeOptions.getElementsByClassName("checkbox")[0].getElementsByClassName("checkbox-label")[0].setAttribute("for","fake-filter-checkbox"),n.parentNode.appendChild(FakeOptions),SortSelect.addEventListener("change",ReupdateFilter),FilterCheckbox.addEventListener("change",ReupdateFilter),t.addEventListener("change",function(){SortSelect.value=t.value}),e.addEventListener("change",function(){FilterCheckbox.value=e.value})}function GetCurrentRobloxServerFilters(){return[SortSelect.value,FilterCheckbox.value]}function ReupdateFilter(){if(CurrentFilterFunction){const t=CurrentFilterFunction,e=CurrentFilterFunctionArgs||[];DisableFilter(),t(...e)}}function EnableFilterMode(t){IsFilterEnabled&&DisableFilter(),IsFilterEnabled=!0,WaitForId("rbx-running-games").then(function(e){const n=e.getElementsByClassName("container-header")[0].getElementsByClassName("server-list-container-header")[0],r=n.children;for(let s=0;s<r.length;s++){const o=r[s];if(o.innerText==="Refresh"&&o.className==="btn-more rbx-refresh refresh-link-icon btn-control-xs btn-min-width"){HiddenRefreshButton=o,o.style="display:none;";break}}ClearFiltersButton||(ClearFiltersButton=CreateClearFiltersButton(),ClearFiltersButton.addEventListener("click",DisableFilter),n.appendChild(ClearFiltersButton))}),WaitForClass("server-list-options").then(function(e){e.style="display:none;"}),t==!1&&(FakeOptions.style=""),WaitForId("rbx-game-server-item-container").then(function(e){const n=e.children;for(let r=0;r<n.length;r++)FirstEightServerElements.push(n[r]),n[r].parentElement=null;ClearAllChildren(e)})}function SetButtonLoadingState(t){LoadMoreServersButton&&(t?LoadMoreServersButton.removeAttribute("disabled"):LoadMoreServersButton.setAttribute("disabled",""))}async function EnableAvailableSpaces(){let t="",e=!1,n=0;EnableFilterMode(),await ReplaceLoadMoreServersButton();async function r(){if(e)return;SetButtonLoadingState(!1),FilterInt++;const s=FilterInt,[o,l]=await GetRobloxServers(t,!1,!0,10);if(s!=FilterInt)return;if(!o){SetButtonLoadingState(!0);return}t=l.nextPageCursor,e=t==null;const d=await CreateServersFromRobloxServers(l.data);if(s!=FilterInt){for(let a=0;a<d.length;a++)d[a].remove();return}e?LoadMoreServersButton&&LoadMoreServersButton.remove():SetButtonLoadingState(!0)}LoadMoreServersButton.addEventListener("click",r),r()}async function EnableMaxPlayerCount(t){let e="",n=!1,r=0;const s={};EnableFilterMode(),await ReplaceLoadMoreServersButton();async function o(){if(n)return;SetButtonLoadingState(!1),FilterInt++;const l=FilterInt,[d,a]=await GetRobloxServers(e);if(l!=FilterInt)return;if(!d){SetButtonLoadingState(!0);return}e=a.nextPageCursor,n=e==null;const u=[],m=a.data;for(let c=0;c<m.length;c++){const f=m[c];if(f.playing<=t){if(s[f.id])continue;s[f.id]=!0,u.push(f),r++}}const g=await CreateServersFromRobloxServers(u);if(l!=FilterInt){for(let c=0;c<g.length;c++)g[c].remove();return}n?LoadMoreServersButton&&LoadMoreServersButton.remove():SetButtonLoadingState(!0),(r<8||u.length===0)&&o()}LoadMoreServersButton.addEventListener("click",o),o()}async function EnableServerAge(t){let e="",n=!1,r=0;EnableFilterMode(),await ReplaceLoadMoreServersButton();const s=[],o={};function l(){s.sort(function(a,u){return t?a.CreatedTimestamp-u.CreatedTimestamp:u.CreatedTimestamp-a.CreatedTimestamp}),WaitForId("rbx-game-server-item-container").then(function(a){for(let u=0;u<s.length;u++){const m=s[u];a.appendChild(m.element)}})}async function d(){if(n)return;SetButtonLoadingState(!1),FilterInt++;const a=FilterInt,[u,m]=await GetRobloxServers(e);if(a!=FilterInt)return;if(!u){SetButtonLoadingState(!0);return}e=m.nextPageCursor,n=e==null;const g=[],c={},f=m.data;for(let i=0;i<f.length;i++)o[f[i].id]||(o[f[i].id]=!0,g.push(f[i].id),c[f[i].id]=f[i]);const[C,S,R]=await RequestFunc(WebServerEndpoints.Servers,"POST",void 0,JSON.stringify({PlaceId:await GetPlaceIdFromGamePage(),JobIds:g}));if(a!=FilterInt)return;if(R.status===402)return SetButtonLoadingState(!0),CreatePaymentPrompt();if(!C){SetButtonLoadingState(!0);return}const y=[];for(let i=0;i<S.length;i++){const v=S[i],p=c[v.JobId];p.CreatedTimestamp=v.CreatedTimestamp,p.Region=v.Region,p.Version=v.Version,y.push(p),s.push(p),r++}const b=await CreateServersFromRobloxServers(y);if(a!=FilterInt){for(let i=0;i<b.length;i++)b[i].remove();return}for(let i=0;i<b.length;i++){const v=b[i];c[v.getAttribute("jobid")].element=v}l(),n?LoadMoreServersButton&&LoadMoreServersButton.remove():SetButtonLoadingState(!0),r<1e3&&d()}LoadMoreServersButton.addEventListener("click",d),d()}async function EnableRandomServers(){let t="",e=!1,n=0;EnableFilterMode(),await ReplaceLoadMoreServersButton();async function r(){if(e)return;SetButtonLoadingState(!1),FilterInt++;const s=FilterInt,[o,l]=await GetRobloxServers(t);if(s!=FilterInt)return;if(!o){SetButtonLoadingState(!0);return}t=l.nextPageCursor,e=t==null;const d=l.data;d.sort(function(){return Math.random()*2-1});const a=await CreateServersFromRobloxServers(d);if(s!=FilterInt){for(let u=0;u<a.length;u++)a[u].remove();return}e?LoadMoreServersButton&&LoadMoreServersButton.remove():SetButtonLoadingState(!0),n<500&&r()}LoadMoreServersButton.addEventListener("click",r),r()}async function EnableSmallestServer(){let t="",e=!1,n=0;EnableFilterMode(),await ReplaceLoadMoreServersButton();async function r(){if(e)return;SetButtonLoadingState(!1),FilterInt++;const s=FilterInt,[o,l]=await GetRobloxServers(t,!0,!1);if(s!=FilterInt)return;if(!o){SetButtonLoadingState(!0);return}t=l.nextPageCursor,e=t==null;const d=await CreateServersFromRobloxServers(l.data);if(s!=FilterInt){for(let a=0;a<d.length;a++)d[a].remove();return}e?LoadMoreServersButton&&LoadMoreServersButton.remove():SetButtonLoadingState(!0)}LoadMoreServersButton.addEventListener("click",r),r()}function DistanceBetweenCoordinates(t,e,n,r){var s=.017453292519943295,o=Math.cos,l=.5-o((n-t)*s)/2+o(t*s)*o(n*s)*(1-o((r-e)*s))/2;return 12742*Math.asin(Math.sqrt(l))}async function EnableBestConnection(){let t="",e=!1,n=!1,r=0;EnableFilterMode(!1),CurrentFilterFunction=EnableBestConnection,await ReplaceLoadMoreServersButton();const s=[];function o(){s.sort(function(c,f){return c.Distance==f.Distance?n?c.playing-f.playing:f.playing-c.playing:c.Distance-f.Distance}),WaitForId("rbx-game-server-item-container").then(function(c){for(let f=0;f<s.length;f++){const C=s[f];c.appendChild(C.element)}})}let l,d,a,u=!1;async function m(){for(;u;)await sleep(100);if(!(l&&d&&!a)){for(u=!0,navigator.geolocation.getCurrentPosition(function(c){l=c.coords.latitude,d=c.coords.longitude},function(c){a=c.message},{maximumAge:86400,timeout:10*1e3,enableHighAccuracy:!1});!l&&!d&&!a;)await sleep(100);u=!1}}async function g(){if(e)return;SetButtonLoadingState(!1),FilterInt++;const c=FilterInt;if(await m(),a){SetButtonLoadingState(!0),CreateShowServersError(a),console.log(a);return}if(c!=FilterInt)return;const[f,C]=GetCurrentRobloxServerFilters();n=f=="Asc";const[S,R]=await GetRobloxServers(t,f=="Asc",C);if(c!=FilterInt)return;if(!S){SetButtonLoadingState(!0);return}t=R.nextPageCursor,e=t==null;const y=[],b={},i=R.data;for(let h=0;h<i.length;h++)y.push(i[h].id),b[i[h].id]=i[h];const[v,p,P]=await RequestFunc(WebServerEndpoints.Servers,"POST",void 0,JSON.stringify({PlaceId:await GetPlaceIdFromGamePage(),JobIds:y,IncludeCoordinates:!0}));if(c!=FilterInt)return;if(P.status===402)return SetButtonLoadingState(!0),CreatePaymentPrompt();if(!v){SetButtonLoadingState(!0);return}const x=[];for(let h=0;h<p.length;h++){const F=p[h],w=F.Coordinates,E=b[F.JobId];E.CreatedTimestamp=F.CreatedTimestamp,E.Region=F.Region,E.Version=F.Version,E.Coordinates=w,E.Distance=w&&DistanceBetweenCoordinates(w.Lat,w.Lng,l,d)||999999999999,x.push(E),s.push(E),r++}const I=await CreateServersFromRobloxServers(x);if(c!=FilterInt){for(let h=0;h<I.length;h++)I[h].remove();return}for(let h=0;h<I.length;h++){const F=I[h];b[F.getAttribute("jobid")].element=F}o(),e?LoadMoreServersButton&&LoadMoreServersButton.remove():SetButtonLoadingState(!0),r<1e3&&g()}LoadMoreServersButton.addEventListener("click",g),g()}async function EnableRegionFilter(t){let e="",n=!1,r=0;const s={};EnableFilterMode(!1),CurrentFilterFunction=EnableRegionFilter,CurrentFilterFunctionArgs=[t],await ReplaceLoadMoreServersButton();async function o(){if(n)return;SetButtonLoadingState(!1),FilterInt++;const l=FilterInt,[d,a]=GetCurrentRobloxServerFilters(),[u,m]=await GetRobloxServers(e,d=="Asc",a);if(l!=FilterInt)return;if(!u){SetButtonLoadingState(!0);return}e=m.nextPageCursor,n=e==null;const g=[],c={},f=m.data;for(let i=0;i<f.length;i++)s[f[i].id]||(s[f[i].id]=!0,g.push(f[i].id),c[f[i].id]=f[i]);const[C,S,R]=await RequestFunc(WebServerEndpoints.Servers,"POST",void 0,JSON.stringify({PlaceId:await GetPlaceIdFromGamePage(),JobIds:g}));if(l!=FilterInt)return;if(R.status===402)return SetButtonLoadingState(!0),CreatePaymentPrompt();if(!C){SetButtonLoadingState(!0);return}const y=[];for(let i=0;i<S.length;i++){const v=S[i];if(v.Region!==t)continue;const p=c[v.JobId];p.CreatedTimestamp=v.CreatedTimestamp,p.Region=v.Region,p.Version=v.Version,y.push(p),r++}const b=await CreateServersFromRobloxServers(y);if(l!=FilterInt){for(let i=0;i<b.length;i++)b[i].remove();return}n?LoadMoreServersButton&&LoadMoreServersButton.remove():SetButtonLoadingState(!0),(r<8||y.length===0)&&o()}LoadMoreServersButton.addEventListener("click",o),o()}async function DisableFilter(){IsFilterEnabled=!1,FilterInt++,CurrentFilterFunction=null,CurrentFilterFunctionArgs=null,FakeOptions.style="display:none;",WaitForClass("server-list-options").then(function(t){t.style=""}),WaitForId("rbx-game-server-item-container").then(function(t){if(ClearAllChildren(t),HiddenRefreshButton){for(let e=0;e<FirstEightServerElements.length;e++)t.appendChild(FirstEightServerElements[e]);FirstEightServerElements=[],HiddenRefreshButton.style="margin-left: 16px;"}}),ClearFiltersButton&&(ClearFiltersButton.remove(),ClearFiltersButton=null),DefaultLoadMoreServersButton&&(DefaultLoadMoreServersButton.style=""),LoadMoreServersButton&&LoadMoreServersButton.remove(),HiddenRefreshButton&&HiddenRefreshButton.click()}setTimeout(GetRobloxSorts,0);

//# sourceMappingURL=https://roqol.io/assets/sourcemap/chrome/2.33.1/js/pages/serverfilters/showservers.js