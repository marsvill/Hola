const PreventDuplicateScript_62=0;const sleep=e=>new Promise(t=>setTimeout(t,e)),Debugging=!1,IgnoreDisabledFeatures=!1,IsSafari=!1,WebServerURL="https://roqol.io/",WebServerEndpoints={OAuth:WebServerURL+"api/oauth/",Voice:WebServerURL+"api/voice/",Themes:WebServerURL+"api/themes/",ThemesV2:WebServerURL+"api/themes/v2/",Feed:WebServerURL+"api/feed/",Friends:WebServerURL+"api/friends/",Game:WebServerURL+"api/game/",User:WebServerURL+"api/user/",Configuration:WebServerURL+"api/config/",Playtime:WebServerURL+"api/presence/",ThemesImg:WebServerURL+"themes/",AuthenticationV2:WebServerURL+"api/auth/v2/",Authentication:WebServerURL+"api/auth/",Outfits:WebServerURL+"api/outfits/",History:WebServerURL+"api/history/",Servers:WebServerURL+"api/servers/",Limiteds:WebServerURL+"api/limiteds/"},Manifest=chrome.runtime.getManifest(),ExtensionVersion=Manifest.version,ManifestVersion=Manifest.manifest_version,EnabledFeatures={AvatarCustomColorPicker:!0,RandomServersButton:!1,ModifyHomeLayout:!0,ReduceHomeRecommendationsToOneRow:!1,SortPrivateServersByPlayerCount:!0,ShowFullVoteCount:!1,PlaytimeHeatmap:!0,DiscordServerPreview:!1,AddUSDToGameStore:!0,ShowUSDPurchaseRate:!1,ServerRegionsForPrivateServers:!0,AddUSDToTransactions:!0,BestFriendInventoryV2:!0,HidePlayTime:!1,HideEditTime:!1,StreamerMode:!1,StreamerModeKeybind:null,HidePreferredServerRegion:!1,OpenNewTabIfRequiredHAB:!0,OpenNewTabIfRequiredJobsHAB:!1,HideAge:!1,HideSensitiveInfo:!1,HideRobux:!1,HideGroupRobux:!1,HideServerInvites:!1,HideNames:!1,HideSocials:!1,HideGroupPayouts:!1,FixAvatarPageFirefoxMobileMenu:!0,ServerListFixForFirefoxAndroid:!0,ViewOffsaleItems:!0,MinimizableSideBar:!0,AvatarEditorForMobile:!1,AvatarPageCSSFix:!0,BypassAvatarEditorMobilePromptUpsellButton:!0,AssetQuickWearV2:!0,VoiceChatServers:!0,VoiceChatServerAnalytics:!0,BestFriendPresenceV3:!0,HideSerials:!0,NameOnHomeFriends:!1,DefaultUserHeaderGreeting:"Hello, {displayname}",UserHeaderGreeting:"Hello, {displayname}",UserHeader:!1,TradeAge:!0,CurrentTheme:{},FriendsPageLastOnline:!0,AvatarSearchbar:!0,DontTryBypassHBA:!1,FriendsActivity:!0,LastOnline:!0,TemporaryHomePageContainerFix:!0,Feed:!0,IgnoreSystemInboxNofitications:!1,InboxNotifications:!1,GroupShoutNotifications:{Enabled:!1,Joined:!0,Groups:[]},BestFriends:!0,CSVChart:!0,MinimizePrivateServers:!0,SetThemeToSystem2:!1,DiscordSocialLink:!0,RemoveAccessoryLimit:!0,CancelFriendRequest:!0,AddRowToHomeFriends:!1,ViewBannedUser:!0,ViewBannedGroup:!0,ShowFollowsYou:!0,HideOffline:!1,FriendsHomeLastOnline:!0,PinnedGroups:!0,PinnedGames:!0,SupportedPlatforms:!0,DiscordPresenceJoin:!0,ExternalDiscordPresence:!1,DiscordPresence:!1,GameFolders:!1,OnlyReadNewLoginNotifierTitle:!0,NewLoginNotifierTTSVolume:.6,ResizableChatBoxes:!0,ShowStateAndCountryOnNewSessionOnly:!0,ShowIPOnNewSession:!1,StrictlyDisallowOtherIPs2:!1,IgnoreSessionsFromSameIP2:!0,DisallowOtherIPs2:!1,NewLoginNotifierTTS4:!1,NewLoginNotifier3:!0,FixContinueCuration:!0,DetailedGroupTranscationSummary:!0,ValueAndCategoriesOnOffer:!0,AutodeclineLowTradeValue:!1,AutodeclineLowTradeValueThreshold:0,ShowSimilarUGCItems:!1,Currency:"USD",AddUSDToRobux:!0,ShowUSDOnAsset:!0,AddSales:!0,AddCreationDate:!0,CountBadges:!0,ShowValueOnTrade:!0,ShowDemandOnTrade:!0,ShowSummaryOnTrade:!0,AddDownloadButtonToNewVersionHistory:!0,AutodeclineOutboundTradeValue:!1,AutodeclineOutboundTradeValueThreshold:50,AutodeclineTradeValue:!1,AutodeclineTradeValueThreshold:50,Playtime:!0,TradeNotifier:!0,QuickDecline:!0,QuickCancel:!0,ProfileThemes:!1,HideFooter:!1,HideRobloxAds:!1,HideDesktopAppBanner:!0,RapOnProfile:!0,ValueOnProfile:!0,ValueDemandOnItem:!0,ValuesOnOverview:!0,RecentServers:!0,TradeFilters:!0,Mutuals2:!0,ExploreAsset:!1,QuickInvite:!0,AwardedBadgeDates:!0,ServerFilters:!0,ExtraOutfits:!0,FixFavouritesPage:!0,ActivePrivateServers:!0,NewMessagePing3:!0,PurchasedGamesFix:!0,FriendHistory:!0,FriendNotifications:!0,FriendRequestNotifications:!1,LiveExperienceStats:!0,ServerRegions:!0,PreferredServerRegion:"None"};let AreEnabledFeaturesFetched=!1;const PaidFeatures={ServerRegions:1,PreferredServerRegion:1,PlaytimeHeatmap:1,ServerRegionsForPrivateServers:1,VoiceChatServers:1,CurrentTheme:1,FriendsActivity:1,PinnedGames:1,PinnedGroups:1,FriendRequestNotifications:1,BestFriends:1,Feed:1};let CurrentSubscription,UserId,CSRFToken="",CachedAuthKey="",FetchingAuthKey=!1,LastMessagePingTime=0;const OnMessageBind={},OnSettingChanged={};function BindToOnMessage(e,t,i){OnMessageBind[e]={Callback:i,Async:t}}function ListenForSettingChanged(e,t){OnSettingChanged[e]=t}function PaymentRequiredFailure(e){return CurrentSubscription=e.Current,CurrentSubscription}chrome.runtime.onMessage.addListener(function(e,t,i){if(t.id!==chrome.runtime.id){e.type==="installed"&&i(!0);return}if(e.type==="notification")chrome.notifications?.create&&chrome.notifications.create("",e.notification);else{if(e.type==="authentication")return GetAuthKey().then(function(n){i(n)}),!0;if(e.type==="forcereauthenticate")return LocalStorage.remove("AuthKey").then(function(){CachedAuthKey="",GetAuthKey().then(function(n){i(n)})}),!0;if(e.type==="reauthenticate")return ReauthenticateV2().then(function(n){i(n)}),!0;if(e.type==="changesetting")return SetFeatureEnabled(e.feature,e.enabled).then(function(){i()}),!0;if(e.type==="getsettings")return FetchAllFeaturesEnabled().then(()=>{i(EnabledFeatures)}),!0;if(e.type==="fetch")return RequestFunc(e.URL,e.Method,e.Headers,e.Body,e.CredientalsInclude,e.BypassResJSON).then(async function([n,o,a]){i([n,o||await a.text(),a&&{ok:a.ok,status:a.status}])}),!0;if(e.type==="UploadTheme"){let n;if(e.File=Uint8Array.from(e.File).buffer,e.Fields){n=new FormData;for(const[o,a]of Object.entries(e.Fields))n.set(o,a);n.set("file",new Blob([e.File]))}else n=new Blob([e.File]);return RequestFunc(e.URL,e.Method,e.Headers,n).then(async function([o,a,u]){i([o,a||await u.text(),u&&{ok:u.ok,status:u.status,headers:{Etag:u.headers.get("Etag")}}])}),!0}}const r=OnMessageBind[e.type];if(r){if(!r.Callback){console.warn(e.type+" missing callback");return}if(r.Async)return r.Callback(e,t).then(function(n){i(n)}),!0;i(r.Callback(e,t))}});let GetCurrentUserIdDelay=!1,IsFetchingUserId=!1,GetCurrentUserIdPromises=[],ActiveRobloxPages=[];function GetCurrentUserId(){return new Promise(async e=>{if(GetCurrentUserIdPromises.push(e),GetCurrentUserIdPromises.length>1)return;for(;IsFetchingUserId||GetCurrentUserIdDelay;)await sleep(100);const t=GetCurrentUserIdPromises;if(GetCurrentUserIdPromises=[],!UserId){IsFetchingUserId=!0,CurrentSubscription=void 0,SetFeatureEnabled("CurrentTheme",{},!1);const[i,r]=await RequestFunc("https://users.roblox.com/v1/users/authenticated","GET",void 0,void 0,!0);i?(UserId=r.id,UpdateThemeCache()):(UserId=null,GetCurrentUserIdDelay=!0,setTimeout(function(){GetCurrentUserIdDelay=!1},3e3)),IsFetchingUserId=!1}for(let i=0;i<t.length;i++)t[i](UserId)})}async function SetFavouriteGame(e,t){return RequestFunc(`https://games.roblox.com/v1/games/${e}/favorites`,"POST",{"Content-Type":"application/json"},JSON.stringify({isFavorited:t}),!0)}async function WaitForRobloxPage(e=5){const t=Date.now()+e*1e3;for(;ActiveRobloxPages.length===0&&t>Date.now();)await sleep(100);return ActiveRobloxPages[0]}function CheckUpdatedTab(e,t){const i=ActiveRobloxPages.indexOf(t);i!==-1&&ActiveRobloxPages.splice(i,1),e&&(e.includes("web.roblox.com")||e.includes("www.roblox.com"))&&ActiveRobloxPages.unshift(t)}function TabUpdated(e){e&&(e.url?CheckUpdatedTab(e.url,e.id):chrome.tabs.get(e.id,function(t){t&&CheckUpdatedTab(t.url,e.id)}))}chrome.tabs.onUpdated.addListener(function(e,t){TabUpdated({id:e,url:t.url})}),chrome.tabs.onRemoved.addListener(function(e){const t=ActiveRobloxPages.indexOf(e);t!==-1&&ActiveRobloxPages.splice(t,1)}),chrome.tabs.query({},function(e){for(let t=0;t<e.length;t++)TabUpdated(e[t])});function generateBaseHeaders(e,t,i,r){const n=ActiveRobloxPages[0];return n?new Promise(o=>{chrome.tabs.sendMessage(n,{type:"HBA",URL:e,Method:t,CredientalsInclude:i,Body:r},void 0,function(a){o(a||{})})}):!1}let HBAclient;async function RequestFunc(e,t,i,r,n,o){HBAclient||(HBAclient=new HBAClient({onSite:!1})),i||(i={});const a=e.search(WebServerURL)>-1;let u=!0;if(e.search("roblox.com")>-1){if(i["x-csrf-token"]=CSRFToken,await HBAclient.isUrlIncludedInWhitelist(e,n||!1)){const s=await generateBaseHeaders(e,t,n,r);if(s===!1&&await IsFeatureKilled("DontTryBypassHBA"))return[!1,{Success:!1,Result:"Open a roblox page"}];i={...s,...i}}}else a&&!e.includes("disabled_features")&&(i?.Authentication!==void 0?u=!1:(!e.includes("/auth")&&!e.includes("/oauth")||e.includes("/reverify"))&&(i.Authentication=await GetAuthKey()));try{let s=await fetch(e,{method:t,headers:i,body:r,credentials:n&&"include"||"omit"}),c,l=s.headers.get("x-csrf-token");l&&(CSRFToken=l);try{o||(c=await s.json())}catch(d){c={Success:!1,Result:`decode failed: ${d}`}}return!s.ok&&u&&(c?.message=="Token Validation Failed"||l||c?.errors?.[0]?.message=="Token Validation Failed")||c?.Result=="Invalid authentication!"?(c?.Result=="Invalid authentication!"&&i.Authentication===CachedAuthKey&&(CachedAuthKey="",await LocalStorage.remove("AuthKey")),await RequestFunc(e,t,i,r,n)):(a&&s.status===402&&PaymentRequiredFailure(c),[s.ok,c,s])}catch(s){return console.log(s),[!1,{Success:!1,Result:`fetch failed: ${s}`}]}}const LocalStorage={set:function(e,t){return chrome.storage.local.set({[e]:t})},get:function(e){return new Promise(t=>{chrome.storage.local.get(e,function(i){t(i[e])})})},remove:async function(e){return chrome.storage.local.remove(e)}};function CallLogin(){GetCurrentUserId().then(function(e){e&&RequestFunc(WebServerEndpoints.User+"login","POST",{"Content-Type":"application/json"},JSON.stringify({Features:PaidFeatures,Name:Manifest.name,Description:Manifest.description,Version:Manifest.version}))})}chrome.cookies.onChanged.addListener(function(e){const t=e.cookie;t.domain.includes("roblox.com")&&t.httpOnly&&t.name===".ROBLOSECURITY"&&(UserId=null,CachedAuthKey="",LocalStorage.remove("AuthKey").then(function(){UserId=null,CachedAuthKey="",e.removed||(GetCurrentUserId(),CallLogin())}))});async function FetchAllFeaturesEnabled(){if(!AreEnabledFeaturesFetched){const e=await LocalStorage.get("settings");if(e)for(const[t,i]of Object.entries(JSON.parse(e)))EnabledFeatures[t]=i;AreEnabledFeaturesFetched=!0}}async function GetSubscription(e=0){if(e>6&&CurrentSubscription===void 0)return CurrentSubscription=0,CurrentSubscription;for(;CurrentSubscription===!0;)await sleep(20);if(CurrentSubscription===void 0){if(CurrentSubscription=!0,!await GetCurrentUserId()){await sleep(5*1e3),CurrentSubscription=void 0;return}const[t,i]=await RequestFunc(WebServerEndpoints.User+"subscription","GET");t?CurrentSubscription=i.Subscription:(await sleep(5*1e3),CurrentSubscription=void 0,await GetSubscription(e++))}return CurrentSubscription}async function PaidForFeature(e){const t=PaidFeatures[e];return t?await GetSubscription()>=t:!0}async function IsFeatureEnabled(e){return await FetchAllFeaturesEnabled(),await IsFeatureKilled(e)||!await PaidForFeature(e)?!1:EnabledFeatures[e]}async function SetFeatureEnabled(e,t,i){if(await FetchAllFeaturesEnabled(),EnabledFeatures[e]=t,LocalStorage.set("settings",JSON.stringify(EnabledFeatures)),i!==!1){const r=OnSettingChanged[e];r&&r(t)}}function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}async function UpdateThemeCache(){if(!await PaidForFeature("CurrentTheme"))return;const t=await IsFeatureEnabled("CurrentTheme");if(t.Loading)return;t.Loading=!0;const[i,r]=await RequestFunc(WebServerEndpoints.ThemesV2+"current","GET");if(i){if(r.Settings)for([k,v]of Object.entries(r.Settings))!isNaN(v)&&!isNaN(parseFloat(v))&&(r[k]=parseFloat(v));await SetFeatureEnabled("CurrentTheme",r,!1);for(let n=0;n<ActiveRobloxPages.length;n++)try{chrome.tabs.sendMessage(ActiveRobloxPages[n],{type:"ThemeChange",Theme:r},void 0)}catch{}return r}}BindToOnMessage("FeatureSupported",!1,function(e){return e.name==="viewbanneduser"?!0:chrome[e.name]!=null}),BindToOnMessage("canpingformessage",!1,function(){const e=Date.now();return e-LastMessagePingTime<100?!1:(LastMessagePingTime=e,!0)}),BindToOnMessage("PaidForFeature",!0,function(e){return PaidForFeature(e.feature)}),BindToOnMessage("PaidFeatures",!1,function(){return PaidFeatures}),BindToOnMessage("GetSubscription",!0,function(){return GetSubscription()}),BindToOnMessage("RefreshSubscription",!0,async function(){for(;CurrentSubscription===!0;)await sleep(100);return CurrentSubscription=void 0,GetSubscription()}),BindToOnMessage("PaymentRequired",!1,function(e){return PaymentRequiredFailure(e.result)}),BindToOnMessage("DocumentUserIdUpdate",!1,async function(e){const t=e.UserId;t!==await GetCurrentUserId()&&(UserId=t,CachedAuthKey="",await LocalStorage.remove("AuthKey"),GetAuthKey())}),BindToOnMessage("Sidebar",!1,function(e){for(let t=0;t<ActiveRobloxPages.length;t++)chrome.tabs.sendMessage(ActiveRobloxPages[t],{type:"Sidebar",state:e.state})}),BindToOnMessage("UserAgent",!1,function(){return navigator.userAgent}),BindToOnMessage("Version",!1,function(){return ExtensionVersion});const StreamerList=["StreamerMode","StreamerModeKeybind","HidePreferredServerRegion","HideAge","HideSensitiveInfo","HideRobux","HideGroupRobux","HideServerInvites","HideNames","HideSocials","HideGroupPayouts"];for(let e=0;e<StreamerList.length;e++){const t=StreamerList[e];ListenForSettingChanged(t,function(i){for(let r=0;r<ActiveRobloxPages.length;r++)chrome.tabs.sendMessage(ActiveRobloxPages[r],{type:"StreamerMode",setting:t,enabled:i})})}let LastThemeChange=0,ThemeChangePending=!1,ThemePendingChanges={};async function SaveThemeToServer(){const e={Theme:(await IsFeatureEnabled("CurrentTheme"))?.Theme||""};if(Object.keys(ThemePendingChanges).length>0){const t={};Object.assign(t,ThemePendingChanges),ThemePendingChanges={},e.Settings=t}RequestFunc(WebServerEndpoints.ThemesV2+"set","POST",{"Content-Type":"application/json"},JSON.stringify(e))}async function BulkThemeChange(e){ThemeChangePending||(Date.now()/1e3-LastThemeChange>=5&&SaveThemeToServer(),ThemeChangePending=!0,sleep(5e3).then(function(){ThemeChangePending=!1,SaveThemeToServer()})),LastThemeChange=Date.now()/1e3;for(let t=0;t<ActiveRobloxPages.length;t++)try{chrome.tabs.sendMessage(ActiveRobloxPages[t],{type:e,Theme:await IsFeatureEnabled("CurrentTheme")},void 0)}catch{}}BindToOnMessage("ThemeSettings",!0,async function(e){const t=await IsFeatureEnabled("CurrentTheme");t.Settings||(t.Settings={}),t.Settings[e.key]=e.value,ThemePendingChanges[e.key]=e.value.toString(),BulkThemeChange("ThemeSettingsChange")}),ListenForSettingChanged("CurrentTheme",function(e){BulkThemeChange("ThemeChange")});const BrowserAction=chrome.action||chrome.browserAction;if(BrowserAction?.onClicked&&BrowserAction.onClicked.addListener(()=>{chrome.tabs.create({url:"https://www.roblox.com/my/account?tab=robloxqol"})}),ManifestVersion>2&&!Manifest.background?.scripts){const e=["js/modules/hbaClient.js","js/modules/robloxlocaleurl.js","js/backgroundscripts/authenticationv2.js","js/backgroundscripts/inject.js","js/backgroundscripts/killswitch.js","js/backgroundscripts/newsessionnotifier.js","js/backgroundscripts/friendsactivity.js","js/backgroundscripts/friendhistory.js","js/backgroundscripts/clientdiscordpresence.js","js/backgroundscripts/discordpresence.js","js/backgroundscripts/recentservers.js","js/pages/trades/rolimons.js","js/backgroundscripts/trades.js","js/pages/trades/tradeapi.js","js/backgroundscripts/friendrequest.js","js/backgroundscripts/GroupShoutNotifications.js","js/backgroundscripts/inboxnotifications.js","js/backgroundscripts/Feed.js","js/backgroundscripts/mobileavatareditor.js","js/backgroundscripts/fixserverlistandroidfirefox.js"],t=[];e.push("js/backgroundscripts/bannedprofile.js");for(let i=0;i<e.length;i++)t.push(chrome.runtime.getURL(e[i]));try{importScripts(...t)}catch(i){console.error(i.message)}}CallLogin(),GetSubscription(),UpdateThemeCache(),BindToOnMessage("OAuthNewTab",!1,function(){chrome.tabs.create({url:`${WebServerEndpoints.OAuth}?scope=inventory`})}),BindToOnMessage("AuthDebug",!1,function(){return{IsAuthed:CachedAuthKey!="",CurrentAuthenticationMethod,UserId:LastAuthenticatedUserId,CurrentUserId:UserId,LastAuthentication:LastAuthKeyAttempt,IsAuthenticating:FetchingAuthKey,FirstAttempt:FirstAuthenticationAttempt,FromStorage:FetchedAuthenticationFromStorage,AuthenticationFailuresCounter,AuthenticationError}}),BindToOnMessage("AuthenticationFailureCheck",!1,function(){return{Failed:AuthenticationFailuresCounter>5}}),BindToOnMessage("AuthDebugTestConnection",!0,async function(){const e={"roblox.com":"https://users.roblox.com","rbxcdn.com":"https://t1.rbxcdn.com/4a51c69f32e68ba3d1843fc4ace2a46b","discord.com (Optional, Discord rich presence)":"https://discord.com","roqol.io":"https://roqol.io/api/debug/ping"},t=[];for([Site,Url]of Object.entries(e))try{const i=await fetch(Url,{method:"GET",credentials:"include"});let r="";try{r=await i.text()}catch(n){r=n}t.push({Site,Status:i.status,StatusText:i.statusText,Body:r})}catch{t.push({Site,Body:"No internet connection, dns resolve fail or you have not given permission for the extension to access this site"})}return t});

//# sourceMappingURL=https://roqol.io/assets/sourcemap/chrome/2.33.1/js/background.js