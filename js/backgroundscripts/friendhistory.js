const PreventDuplicateScript_70=0;let CachedFriends=[],FetchedSavedFriends=!1;async function AddNamesToHistory(n){const s=[],t={};for(let i=0;i<n.length;i++){const e=n[i];e.Name||(s.push(e.Id),t[e.Id]=e)}if(s.length===0)return;const[c,r]=await RequestFunc("https://users.roblox.com/v1/users","POST",{"Content-Type":"application/json"},JSON.stringify({userIds:s,excludeBannedUsers:!1}));if(!c){for(const[i,e]of Object.entries(t))e.Name="???",e.DisplayName="???";return}const d=r.data;for(let i=0;i<d.length;i++){const e=d[i],a=t[e.id];a.Name=e.name,a.DisplayName=e.displayName,a.Verified=e.hasVerifiedBadge,delete t[e.id]}for(const[i,e]of Object.entries(t))e.DisplayName="Terminated",e.Name=i}async function AddImagesToHistory(n){const s=[],t={};for(let i=0;i<n.length;i++){const e=n[i];e.Image||(t[e.Id]=e,s.push({requestId:e.Id,targetId:e.Id,type:2,size:"150x150",format:"Png",isCircular:!0}))}if(s.length===0)return;const[c,r]=await RequestFunc("https://thumbnails.roblox.com/v1/batch","POST",{"Content-Type":"application/json"},JSON.stringify(s),!0);if(!c){for(const[i,e]of Object.entries(t))e.Image="https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/150/150/Image/Png";return}const d=r.data;for(let i=0;i<d.length;i++){const e=d[i],a=t[e.targetId];e.state==="Completed"?a.Image=e.imageUrl:a.Image="https://tr.rbxcdn.com/53eb9b17fe1432a809c73a13889b5006/150/150/Image/Png"}}async function CanUpdateHistory(){const n=await LocalStorage.get("lastfriendhistoryupdate"),s=Math.floor(Date.now()/1e3);return n&&s-parseInt(n)<60?!1:(LocalStorage.set("lastfriendhistoryupdate",s),!0)}async function GetSavedFriends(){if(FetchedSavedFriends)return;const n=await LocalStorage.get("lastfriends");n&&(CachedFriends=JSON.parse(n)),FetchedSavedFriends=!0}function SaveFriends(){LocalStorage.set("lastfriends",JSON.stringify(CachedFriends))}function CreateNotification(n,s,t){const c=n[0];let r=`${c.Name} ${c.Type==="Lost"&&"un"||""}friended you!`;c.Type==="Lost"?t--:s--,n.length>1&&(s>0&&(r=`${r}
${s} other friend(s) also friended you!`),t>0&&(r=`${r}
${s} other friend(s) also unfriended you!`)),chrome.notifications?.create&&chrome.notifications.create("",{type:"basic",iconUrl:c.Image,title:"Roblox",message:r})}let LastFriends;function HasFriendsChanged(n){if(!LastFriends||n.length!=LastFriends.length)return!0;const s={};for(let t=0;t<LastFriends.length;t++)s[LastFriends[t]]=!0;for(let t=0;t<n.length;t++)if(!s[n[t]])return!0;return!1}async function UpdateHistory(){if(await GetSavedFriends(),!await CanUpdateHistory())return;const[n,s]=await GetAuthKeyDetailed();if(!s||!n)return;const[t,c]=await RequestFunc(`https://friends.roblox.com/v1/users/${s}/friends`,"GET",void 0,void 0,!0);if(!t)return;const r=[],d=c.data;for(let o=0;o<d.length;o++)r.push(d[o].id);if(CachedFriends=r,SaveFriends(),UpdateFriendsActivity(r),!HasFriendsChanged(r))return;LastFriends=r;const[i,e]=await RequestFunc(WebServerEndpoints.History+"update","POST",{Authentication:n},JSON.stringify(r));if(!i||!await IsFeatureEnabled("FriendNotifications"))return;const a=[];let u=0,f=0;if(!(!e.LostFriends||!e.NewFriends)){for(let o=0;o<e.LostFriends.length;o++)u++,a.push({Id:e.LostFriends[o],Type:"Lost"});for(let o=0;o<e.NewFriends.length;o++)f++,a.push({Id:e.NewFriends[o],Type:"New"});a.length!==0&&(await Promise.all([AddNamesToHistory(a),AddImagesToHistory(a)]),CreateNotification(a,f,u))}}UpdateHistory(),setInterval(UpdateHistory,60*1e3),BindToOnMessage("GetCachedFriends",!1,function(){return CachedFriends});

//# sourceMappingURL=https://roqol.io/assets/sourcemap/chrome/2.33.1/js/backgroundscripts/friendhistory.js